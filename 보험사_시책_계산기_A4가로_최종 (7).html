<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë³´í—˜ì‚¬ ì‹œì±… ê³„ì‚°ê¸° - ì™„ì „ í†µí•© ë²„ì „ | 2026ë…„ 1ì›”</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700;900&display=swap');
        
        * {
            font-family: 'Noto Sans KR', sans-serif;
        }

        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        .card-shadow {
            box-shadow: 0 10px 40px rgba(0,0,0,0.1);
        }

        .animate-fade-in {
            animation: fadeIn 0.5s ease-in;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .tab-button {
            transition: all 0.3s ease;
        }

        .tab-button.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .company-btn.selected {
            transform: scale(1.1);
            box-shadow: 0 20px 50px rgba(0,0,0,0.3);
        }

        .employee-card {
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .employee-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .page-transition {
            display: none;
        }

        .page-transition.active {
            display: block;
        }

        .paste-area {
            min-height: 300px;
            font-family: monospace;
            font-size: 12px;
        }

        .toast {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 16px 24px;
            background: #10b981;
            color: white;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            z-index: 9999;
            display: none;
            animation: slideIn 0.3s ease;
        }

        @keyframes slideIn {
            from { transform: translateX(400px); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        .admin-tab {
            display: none;
        }

        .admin-tab.active {
            display: block;
        }
        
        /* ì¸ì‡„ìš© ìŠ¤íƒ€ì¼ */
        @media print {
            @page {
                size: A4 landscape;  /* A4 ê°€ë¡œ */
                margin: 12mm;
            }
            
            body {
                background: white !important;
                font-size: 11pt !important;
            }
            
            /* íŠ¹ì • ìš”ì†Œë§Œ ìˆ¨ê¹€ */
            header,
            footer,
            nav,
            #companySelection,
            #searchSection,
            #bulkPrintSection,
            #totalSimulation,
            .toast,
            button,
            .no-print {
                display: none !important;
            }
            
            /* 1í˜ì´ì§€: ì‚¬ì›ì •ë³´ + ì£¼ì°¨ë³„ (í˜ì´ì§€ ë„˜ê¹€) - ì ˆëŒ€ ê±´ë“œë¦¬ì§€ ì•ŠìŒ */
            #employeeInfo {
                display: block !important;
                page-break-after: always !important;
                page-break-inside: auto !important;
            }
            
            /* 2í˜ì´ì§€: ì´ ì‹œì±…ê¸ˆ ê²°ê³¼ (ìƒˆ í˜ì´ì§€ ì‹œì‘, ë¶„í•  ë°©ì§€) */
            #resultSection {
                display: block !important;
                page-break-before: always !important;
                page-break-inside: avoid !important;
                page-break-after: auto !important;
                font-size: 9pt !important;
            }
            
            /* 2í˜ì´ì§€ ë‚´ë¶€ ìš”ì†Œë“¤ë„ ë¶„í•  ë°©ì§€ */
            #resultSection * {
                page-break-inside: avoid !important;
            }
            
            /* 2í˜ì´ì§€ ì œëª© í¬ê¸° ì¡°ì • */
            #resultSection h2 {
                font-size: 14pt !important;
                margin-bottom: 8px !important;
            }
            
            #resultSection h3 {
                font-size: 12pt !important;
                margin-bottom: 6px !important;
            }
            
            #resultSection h4 {
                font-size: 10pt !important;
            }
            
            /* 2í˜ì´ì§€ ì—¬ë°± ì••ì¶• */
            #resultSection .mb-8,
            #resultSection .mb-6 {
                margin-bottom: 12px !important;
            }
            
            #resultSection .mb-4 {
                margin-bottom: 8px !important;
            }
            
            #resultSection .mb-3 {
                margin-bottom: 6px !important;
            }
            
            #resultSection .p-6,
            #resultSection .p-8 {
                padding: 12px !important;
            }
            
            #resultSection .p-4 {
                padding: 8px !important;
            }
            
            /* 2í˜ì´ì§€ ê·¸ë¦¬ë“œ ê°„ê²© */
            #resultSection .gap-4 {
                gap: 8px !important;
            }
            
            /* ë ˆì´ì•„ì›ƒ */
            .card-shadow {
                box-shadow: none !important;
                border: 1px solid #ddd !important;
            }
            
            .gradient-bg {
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%) !important;
                -webkit-print-color-adjust: exact;
                print-color-adjust: exact;
            }
            
            /* ë°°ê²½ìƒ‰ ìœ ì§€ */
            .bg-green-50 {
                background-color: #f0fdf4 !important;
                -webkit-print-color-adjust: exact;
                print-color-adjust: exact;
            }
            
            .bg-purple-50 {
                background-color: #faf5ff !important;
                -webkit-print-color-adjust: exact;
                print-color-adjust: exact;
            }
            
            .bg-red-50 {
                background-color: #fef2f2 !important;
                -webkit-print-color-adjust: exact;
                print-color-adjust: exact;
            }
            
            .bg-orange-50 {
                background-color: #fff7ed !important;
                -webkit-print-color-adjust: exact;
                print-color-adjust: exact;
            }
            
            .bg-yellow-50 {
                background-color: #fefce8 !important;
                -webkit-print-color-adjust: exact;
                print-color-adjust: exact;
            }
            
            .bg-blue-50 {
                background-color: #eff6ff !important;
                -webkit-print-color-adjust: exact;
                print-color-adjust: exact;
            }
            
            /* íšŒì‚¬ëª… ê°•ì¡° */
            #resultCompanyName,
            #weeklyCompanyName {
                font-size: 16pt !important;
                font-weight: 900 !important;
            }
        }
    </style>
</head>
<body class="bg-gray-50">
    
    <!-- Toast ì•Œë¦¼ -->
    <div id="toast" class="toast"></div>

    <!-- í—¤ë” -->
    <header class="gradient-bg text-white py-6 shadow-lg">
        <div class="container mx-auto px-4">
            <div class="flex items-center justify-between flex-wrap gap-4">
                <div>
                    <h1 class="text-3xl font-black mb-1" id="headerTitle">ğŸ’° ë³´í—˜ì‚¬ ì‹œì±… ê³„ì‚°ê¸°</h1>
                    <p class="text-sm opacity-90" id="headerSubtitle"></p>
                </div>
                <div class="text-right">
                    <button onclick="togglePage()" id="pageToggleBtn" class="inline-block bg-white bg-opacity-20 hover:bg-opacity-30 px-4 py-2 rounded-lg mb-2 transition-all cursor-pointer">
                        <span class="text-sm font-bold">âš™ï¸ ê´€ë¦¬ì í˜ì´ì§€</span>
                    </button>
                    <p class="text-xs opacity-70" id="headerDesc">ì‚¬ì›ë³„ ì‹œì±…ê¸ˆ ìë™ ê³„ì‚°</p>
                </div>
            </div>
        </div>
    </header>

    <!-- ê³„ì‚°ê¸° í˜ì´ì§€ -->
    <div id="calculatorPage" class="page-transition active">
        <main class="container mx-auto px-4 py-8">
            
            <!-- ë³´í—˜ì‚¬ ì„ íƒ -->
            <section id="companySelection" class="mb-8 animate-fade-in">
                <div class="bg-white rounded-2xl p-6 card-shadow">
                    <div class="text-center mb-6">
                        <h2 class="text-2xl font-black mb-2 text-gray-800">ğŸ¢ ë³´í—˜ì‚¬ ì„ íƒ</h2>
                        <p class="text-gray-600">ì¡°íšŒí•  ë³´í—˜ì‚¬ë¥¼ ì„ íƒí•˜ì„¸ìš”</p>
                    </div>
                    <div class="grid grid-cols-2 md:grid-cols-5 gap-4">
                        <button onclick="selectCompany('db')" id="btn-db" class="company-btn p-6 rounded-2xl bg-gradient-to-r from-green-400 to-teal-500 text-white hover:scale-105 hover:shadow-2xl transition-all shadow-lg">
                            <div class="text-2xl font-black leading-tight">DB<br>ì†ë³´</div>
                        </button>
                        <button onclick="selectCompany('heungkuk')" id="btn-heungkuk" class="company-btn p-6 rounded-2xl bg-gradient-to-r from-pink-400 to-pink-600 text-white hover:scale-105 hover:shadow-2xl transition-all shadow-lg">
                            <div class="text-2xl font-black leading-tight">í¥êµ­<br>í™”ì¬</div>
                        </button>
                        <button onclick="selectCompany('meritz')" id="btn-meritz" class="company-btn p-6 rounded-2xl bg-gradient-to-r from-red-500 to-red-700 text-white hover:scale-105 hover:shadow-2xl transition-all shadow-lg">
                            <div class="text-2xl font-black leading-tight">ë©”ë¦¬ì¸ <br>í™”ì¬</div>
                        </button>
                        <button onclick="selectCompany('kb')" id="btn-kb" class="company-btn p-6 rounded-2xl bg-gradient-to-r from-yellow-400 to-yellow-600 text-white hover:scale-105 hover:shadow-2xl transition-all shadow-lg">
                            <div class="text-2xl font-black leading-tight">KB<br>ì†ë³´</div>
                        </button>
                        <button onclick="selectCompany('monthly')" id="btn-monthly" class="company-btn p-6 rounded-2xl bg-gradient-to-r from-purple-400 to-purple-600 text-white hover:scale-105 hover:shadow-2xl transition-all shadow-lg">
                            <div class="text-xl font-black leading-tight" id="monthly-company-name">ì´ë‹¬<br>ì£¼ë ¥ì‚¬</div>
                        </button>
                    </div>
                </div>
            </section>

            <!-- ì‚¬ì› ê²€ìƒ‰ -->
            <section class="mb-8 animate-fade-in" id="searchSection" style="display: none;">
                <div class="bg-white rounded-2xl p-6 card-shadow">
                    <h2 class="text-xl font-bold mb-4 text-gray-800">ğŸ” ì‚¬ì› ê²€ìƒ‰</h2>
                    
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
                        <div>
                            <label class="block text-sm font-bold text-gray-700 mb-2">ë³¸ë¶€ ì„ íƒ</label>
                            <select id="branchSelect" class="w-full px-4 py-3 border-2 border-gray-300 rounded-xl" onchange="filterOffices()">
                                <option value="">ì „ì²´</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-bold text-gray-700 mb-2">ì§€ì  ì„ íƒ</label>
                            <select id="officeSelect" class="w-full px-4 py-3 border-2 border-gray-300 rounded-xl" onchange="filterEmployees()">
                                <option value="">ì „ì²´</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-bold text-gray-700 mb-2">ì´ë¦„ ê²€ìƒ‰</label>
                            <input type="text" id="nameSearch" placeholder="ì´ë¦„ ì…ë ¥..." 
                                   class="w-full px-4 py-3 border-2 border-gray-300 rounded-xl"
                                   oninput="filterEmployees()">
                        </div>
                    </div>

                    <!-- ê²€ìƒ‰ ê²°ê³¼ -->
                    <div id="searchResults" class="mt-4">
                        <p class="text-gray-500 text-center py-8">ë³´í—˜ì‚¬ë¥¼ ì„ íƒí•˜ê³  ê²€ìƒ‰í•´ì£¼ì„¸ìš”</p>
                    </div>
                    
                    <!-- ì¼ê´„ ì¸ì‡„ ë²„íŠ¼ -->
                    <div id="bulkPrintSection" style="display: none;" class="mt-4 p-4 bg-blue-50 border-2 border-blue-200 rounded-xl">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="font-bold text-blue-800">ì„ íƒëœ ì‚¬ì›: <span id="selectedCount">0</span>ëª…</p>
                                <p class="text-xs text-gray-600 mt-1">ğŸ’¡ ì²´í¬ë°•ìŠ¤ë¥¼ ì„ íƒí•˜ì—¬ ì—¬ëŸ¬ ì‚¬ì›ì„ í•œ ë²ˆì— ì¸ì‡„í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤</p>
                            </div>
                            <div class="flex gap-2">
                                <button onclick="selectAllEmployees()" class="px-4 py-2 bg-gray-500 text-white font-bold rounded-lg hover:bg-gray-600 transition-all">
                                    âœ“ ì „ì²´ ì„ íƒ
                                </button>
                                <button onclick="deselectAllEmployees()" class="px-4 py-2 bg-gray-500 text-white font-bold rounded-lg hover:bg-gray-600 transition-all">
                                    âœ• ì „ì²´ í•´ì œ
                                </button>
                                <button onclick="printSelectedEmployees()" class="px-6 py-2 bg-blue-600 text-white font-bold rounded-lg hover:bg-blue-700 transition-all">
                                    ğŸ–¨ï¸ ì„ íƒ ì‚¬ì› ì¼ê´„ ì¸ì‡„
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- ì„ íƒëœ ì‚¬ì› ì •ë³´ -->
            <section class="mb-8 animate-fade-in" id="employeeInfo" style="display: none;">
                <div class="bg-white rounded-2xl p-6 card-shadow">
                    <div class="flex items-center justify-between mb-4">
                        <h2 class="text-xl font-bold text-gray-800">ğŸ‘¤ ì„ íƒëœ ì‚¬ì› ì •ë³´</h2>
                        <div class="flex gap-2 no-print">
                            <button onclick="printEmployee()" class="px-4 py-2 bg-blue-500 text-white font-bold rounded-lg hover:bg-blue-600 transition-all">
                                ğŸ–¨ï¸ ì¸ì‡„í•˜ê¸°
                            </button>
                            <button onclick="clearSelection()" class="px-4 py-2 bg-gray-500 text-white font-bold rounded-lg hover:bg-gray-600">
                                âœ• ì„ íƒ í•´ì œ
                            </button>
                        </div>
                    </div>
                    
                    <div class="bg-purple-50 p-4 rounded-xl mb-4">
                        <div class="grid grid-cols-2 md:grid-cols-4 gap-4 text-sm">
                            <div>
                                <p class="text-gray-600">ì´ë¦„</p>
                                <p class="font-bold text-lg" id="selectedName">-</p>
                            </div>
                            <div>
                                <p class="text-gray-600">ì‚¬ì—…ë¶€</p>
                                <p class="font-bold" id="selectedDept">-</p>
                            </div>
                            <div>
                                <p class="text-gray-600">ë³¸ë¶€</p>
                                <p class="font-bold" id="selectedBranch">-</p>
                            </div>
                            <div>
                                <p class="text-gray-600">ì§€ì </p>
                                <p class="font-bold" id="selectedOffice">-</p>
                            </div>
                        </div>
                    </div>

                    <!-- ì£¼ì°¨ë³„ ì—…ì  -->
                    <h3 class="font-bold mb-3">ğŸ“Š <span id="weeklyCompanyName"></span> ì£¼ì°¨ë³„ ì›”ë‚©ë³´í—˜ë£Œ ë° ì‹œì±…ê¸ˆ</h3>
                    <div class="grid grid-cols-1 md:grid-cols-4 gap-4" id="weeklyData">
                        <!-- ë™ì ìœ¼ë¡œ ìƒì„±ë¨ -->
                    </div>
                </div>
            </section>

            <!-- ì´ ì‹œì±…ê¸ˆ ê²°ê³¼ -->
            <section id="resultSection" style="display: none;">
                <div class="bg-white rounded-2xl p-6 card-shadow mb-6 animate-fade-in">
                    <h2 class="text-2xl font-bold mb-6 text-gray-800">ğŸ‰ ì´ ì‹œì±…ê¸ˆ ê³„ì‚° ê²°ê³¼</h2>
                    
                    <div class="bg-gradient-to-r from-purple-50 to-pink-50 p-8 rounded-2xl text-center mb-6">
                        <p class="text-gray-700 mb-2">ğŸ’ <span id="resultCompanyName"></span> ì´ ì‹œì±…ê¸ˆ</p>
                        <p class="text-5xl font-black text-purple-600 mb-4" id="grandTotal">0ë§Œì›</p>
                        <p class="text-sm text-gray-600">ì´ ì›”ë‚©ë³´í—˜ë£Œ: <span class="font-bold" id="totalAmount">0ë§Œì›</span></p>
                    </div>
                    
                    <!-- ë°±ë°±ì²œì²œ ì‹œìƒê¸ˆ -->
                    <div id="baekbaekReward" style="display: none;">
                        <!-- ë™ì ìœ¼ë¡œ ìƒì„±ë¨ -->
                    </div>
                    
                    <!-- ì „ì²´ ì‹œë®¬ë ˆì´ì…˜ -->
                    <div id="totalSimulation" class="mb-6">
                        <!-- ë™ì ìœ¼ë¡œ ìƒì„±ë¨ -->
                    </div>

                    <!-- ì£¼ì°¨ë³„ ìƒì„¸ ë‚´ì—­ -->
                    <div class="grid grid-cols-1 md:grid-cols-4 gap-4" id="detailBreakdown">
                        <!-- ë™ì ìœ¼ë¡œ ìƒì„±ë¨ -->
                    </div>
                </div>
            </section>

        </main>
    </div>

    <!-- ê´€ë¦¬ì í˜ì´ì§€ -->
    <div id="adminPage" class="page-transition">
        <main class="container mx-auto px-4 py-8">
            
            <!-- ê´€ë¦¬ì íƒ­ ì„ íƒ -->
            <section class="mb-8">
                <div class="bg-white rounded-2xl p-6 card-shadow">
                    <div class="flex items-center justify-between mb-4">
                        <h2 class="text-2xl font-bold text-gray-800">âš™ï¸ ê´€ë¦¬ì ê¸°ëŠ¥ ì„ íƒ</h2>
                        <button onclick="changeAdminPassword()" class="px-4 py-2 bg-gradient-to-r from-blue-500 to-blue-600 text-white font-bold rounded-lg hover:shadow-lg transition-all">
                            ğŸ”‘ ë¹„ë°€ë²ˆí˜¸ ë³€ê²½
                        </button>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <button onclick="switchAdminTab('policy')" id="admin-tab-policy" class="tab-button active p-6 rounded-xl border-2 border-gray-300">
                            <div class="text-left">
                                <h3 class="font-bold text-lg mb-2">ğŸ“Š ì‹œì±… ì„¤ì •</h3>
                                <p class="text-sm text-gray-600">ì›”ì‹œì±… ì§€ê¸‰ë¥ , ì£¼ê°„ì‹œìƒ ê¸ˆì•¡ ë“± ì„¤ì •</p>
                            </div>
                        </button>
                        <button onclick="switchAdminTab('employee')" id="admin-tab-employee" class="tab-button p-6 rounded-xl border-2 border-gray-300 bg-gray-50">
                            <div class="text-left">
                                <h3 class="font-bold text-lg mb-2">ğŸ‘¥ ì¸ë³„ ë°ì´í„° ê´€ë¦¬</h3>
                                <p class="text-sm text-gray-600">ì—‘ì…€ ë¶™ì—¬ë„£ê¸°ë¡œ ì‚¬ì›ë³„ ì—…ì  ì…ë ¥</p>
                            </div>
                        </button>
                    </div>
                    <div class="mt-4 p-3 bg-blue-50 border-2 border-blue-200 rounded-lg">
                        <p class="text-xs text-gray-700">
                            ğŸ’¡ <strong>ê¸°ë³¸ ë¹„ë°€ë²ˆí˜¸:</strong> admin1234 (ìµœì´ˆ 1íšŒë§Œ ì‚¬ìš© í›„ ë°˜ë“œì‹œ ë³€ê²½í•˜ì„¸ìš”)
                        </p>
                    </div>
                </div>
            </section>

            <!-- ì‹œì±… ì„¤ì • íƒ­ -->
            <div id="policyTab" class="admin-tab active">
                <!-- ë³´í—˜ì‚¬ íƒ­ -->
                <section class="mb-8">
                    <div class="bg-white rounded-2xl p-4 card-shadow">
                        <div class="flex flex-wrap gap-2">
                            <button onclick="showPolicyCompany('db')" id="policy-tab-db" class="tab-button active px-6 py-3 rounded-lg font-bold">
                                DBì†ë³´
                            </button>
                            <button onclick="showPolicyCompany('heungkuk')" id="policy-tab-heungkuk" class="tab-button px-6 py-3 rounded-lg font-bold bg-gray-100">
                                í¥êµ­í™”ì¬
                            </button>
                            <button onclick="showPolicyCompany('meritz')" id="policy-tab-meritz" class="tab-button px-6 py-3 rounded-lg font-bold bg-gray-100">
                                ë©”ë¦¬ì¸ í™”ì¬
                            </button>
                            <button onclick="showPolicyCompany('kb')" id="policy-tab-kb" class="tab-button px-6 py-3 rounded-lg font-bold bg-gray-100">
                                KBì†ë³´
                            </button>
                            <button onclick="showPolicyCompany('monthly')" id="policy-tab-monthly" class="tab-button px-6 py-3 rounded-lg font-bold bg-gray-100">
                                ì´ë‹¬ì£¼ë ¥ì‚¬
                            </button>
                        </div>
                    </div>
                </section>

                <!-- ë³´í—˜ì‚¬ë³„ ì„¤ì • -->
                <div id="policySettings"></div>

                <!-- ì‹œì±… ë°ì´í„° ê´€ë¦¬ -->
                <section class="mt-8">
                    <div class="bg-white rounded-2xl p-6 card-shadow">
                        <h2 class="text-2xl font-bold mb-4 text-gray-800">ğŸ’¾ ì‹œì±… ë°ì´í„° ê´€ë¦¬</h2>
                        
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
                            <button onclick="saveAllPolicyData()" 
                                    class="px-6 py-4 bg-gradient-to-r from-purple-500 to-pink-500 text-white font-bold rounded-xl hover:shadow-lg transition-all">
                                ğŸ’¾ ì „ì²´ ì €ì¥
                            </button>
                            <button onclick="exportPolicyData()" 
                                    class="px-6 py-4 bg-blue-500 text-white font-bold rounded-xl hover:bg-blue-600 transition-all">
                                ğŸ“¥ ì‹œì±… ë°ì´í„° ë‹¤ìš´ë¡œë“œ
                            </button>
                            <button onclick="document.getElementById('importPolicyFile').click()" 
                                    class="px-6 py-4 bg-green-500 text-white font-bold rounded-xl hover:bg-green-600 transition-all">
                                ğŸ“¤ ì‹œì±… ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸°
                            </button>
                        </div>
                        <input type="file" id="importPolicyFile" accept=".json" style="display: none;" onchange="importPolicyData(event)">
                        
                        <div class="p-4 bg-yellow-50 border-2 border-yellow-200 rounded-xl">
                            <p class="text-sm text-gray-700">
                                ğŸ’¡ <strong>ì‚¬ìš© íŒ:</strong> ë§¤ë‹¬ ì‹œì‘ ì‹œ ì´ì „ ë‹¬ ë°ì´í„°ë¥¼ ë‹¤ìš´ë¡œë“œë°›ì•„ ë°±ì—…í•˜ê³ , 
                                ìƒˆë¡œìš´ ë‹¬ì˜ ì§€ê¸‰ë¥ ì„ ì…ë ¥í•œ í›„ "ì „ì²´ ì €ì¥"ì„ ëˆ„ë¥´ì„¸ìš”!
                            </p>
                        </div>
                    </div>
                </section>
            </div>

            <!-- ì¸ë³„ ë°ì´í„° ê´€ë¦¬ íƒ­ -->
            <div id="employeeTab" class="admin-tab">
                <!-- ì‚¬ìš© ì•ˆë‚´ -->
                <section class="mb-8">
                    <div class="bg-blue-50 border-2 border-blue-200 rounded-2xl p-6">
                        <h2 class="text-xl font-bold text-blue-800 mb-3">ğŸ“‹ ì‚¬ìš© ë°©ë²•</h2>
                        <ol class="space-y-2 text-gray-700">
                            <li><strong>1.</strong> ë³´í—˜ì‚¬ì™€ ì£¼ì°¨ë¥¼ ì„ íƒí•˜ì„¸ìš”</li>
                            <li><strong>2.</strong> ì—‘ì…€ì—ì„œ ë°ì´í„°ë¥¼ ë³µì‚¬í•˜ì„¸ìš” (ì œëª© í–‰ í¬í•¨)</li>
                            <li><strong>3.</strong> ì•„ë˜ í…ìŠ¤íŠ¸ ì˜ì—­ì— ë¶™ì—¬ë„£ê¸° (Ctrl+V)</li>
                            <li><strong>4.</strong> "ë°ì´í„° íŒŒì‹± ë° ì €ì¥" ë²„íŠ¼ì„ í´ë¦­í•˜ì„¸ìš”</li>
                            <li><strong>5.</strong> ëª¨ë“  ë³´í—˜ì‚¬/ì£¼ì°¨ ë°ì´í„° ì…ë ¥ í›„ "ì „ì²´ ì €ì¥"ì„ í´ë¦­í•˜ì„¸ìš”</li>
                        </ol>
                        <div class="mt-4 p-3 bg-yellow-50 border-2 border-yellow-300 rounded-lg">
                            <p class="text-sm font-bold text-yellow-800">
                                âš ï¸ ì¤‘ìš”: <span class="text-red-600">"ì›”ë‚©ë³´í—˜ë£Œ"</span> ì»¬ëŸ¼ì˜ ê°’ì´ ì—…ì ìœ¼ë¡œ ë°˜ì˜ë©ë‹ˆë‹¤!
                            </p>
                        </div>
                    </div>
                </section>

                <!-- ë³´í—˜ì‚¬ ì„ íƒ -->
                <section class="mb-8">
                    <div class="bg-white rounded-2xl p-6 card-shadow">
                        <h2 class="text-xl font-bold mb-4">ğŸ¢ ë³´í—˜ì‚¬ ì„ íƒ</h2>
                        <div class="grid grid-cols-2 md:grid-cols-5 gap-3">
                            <button onclick="selectEmployeeCompany('db')" id="emp-tab-db" class="tab-button active px-6 py-4 rounded-xl font-bold">
                                DBì†ë³´
                            </button>
                            <button onclick="selectEmployeeCompany('heungkuk')" id="emp-tab-heungkuk" class="tab-button px-6 py-4 rounded-xl font-bold bg-gray-100">
                                í¥êµ­í™”ì¬
                            </button>
                            <button onclick="selectEmployeeCompany('meritz')" id="emp-tab-meritz" class="tab-button px-6 py-4 rounded-xl font-bold bg-gray-100">
                                ë©”ë¦¬ì¸ í™”ì¬
                            </button>
                            <button onclick="selectEmployeeCompany('kb')" id="emp-tab-kb" class="tab-button px-6 py-4 rounded-xl font-bold bg-gray-100">
                                KBì†ë³´
                            </button>
                            <button onclick="selectEmployeeCompany('monthly')" id="emp-tab-monthly" class="tab-button px-6 py-4 rounded-xl font-bold bg-gray-100">
                                ì´ë‹¬ì£¼ë ¥ì‚¬
                            </button>
                        </div>
                    </div>
                </section>

                <!-- ì£¼ì°¨ ì„ íƒ -->
                <section class="mb-8">
                    <div class="bg-white rounded-2xl p-6 card-shadow">
                        <h2 class="text-xl font-bold mb-4">ğŸ“… ì£¼ì°¨ ì„ íƒ</h2>
                        <div class="grid grid-cols-2 md:grid-cols-5 gap-3">
                            <button onclick="selectWeek(0)" id="week-0" class="tab-button px-6 py-4 rounded-xl font-bold bg-gray-100">
                                ì „ì£¼ì°¨<br><span class="text-xs">(ì „ì›”)</span>
                            </button>
                            <button onclick="selectWeek(1)" id="week-1" class="tab-button active px-6 py-4 rounded-xl font-bold">
                                1ì£¼ì°¨
                            </button>
                            <button onclick="selectWeek(2)" id="week-2" class="tab-button px-6 py-4 rounded-xl font-bold bg-gray-100">
                                2ì£¼ì°¨
                            </button>
                            <button onclick="selectWeek(3)" id="week-3" class="tab-button px-6 py-4 rounded-xl font-bold bg-gray-100">
                                3ì£¼ì°¨
                            </button>
                            <button onclick="selectWeek(4)" id="week-4" class="tab-button px-6 py-4 rounded-xl font-bold bg-gray-100">
                                4ì£¼ì°¨
                            </button>
                        </div>
                        <div class="mt-4 p-3 bg-purple-50 border-2 border-purple-300 rounded-lg">
                            <p class="text-sm font-bold text-purple-800 mb-2">ğŸ’¡ ì „ì£¼ì°¨ë€?</p>
                            <p class="text-sm text-gray-700">
                                ì „ì£¼ì°¨(ì „ì›”)ëŠ” 1ì£¼ì°¨ì˜ <strong>ì—°ì†ê°€ë™ ì‹œìƒ ê³„ì‚°</strong>ì„ ìœ„í•œ ì°¸ê³  ë°ì´í„°ì…ë‹ˆë‹¤.<br>
                                ì „ì›” ë§ˆì§€ë§‰ ì£¼ì°¨ ë°ì´í„°ë¥¼ ì…ë ¥í•˜ë©´, 1ì£¼ì°¨ ì—°ì†ê°€ë™ ë‹¬ì„± ì—¬ë¶€ë¥¼ ì •í™•í•˜ê²Œ íŒë‹¨í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
                            </p>
                        </div>
                    </div>
                </section>

                <!-- ë°ì´í„° ì…ë ¥ ì˜ì—­ -->
                <section class="mb-8">
                    <div class="bg-white rounded-2xl p-6 card-shadow">
                        <div class="flex items-center justify-between mb-4">
                            <h2 class="text-xl font-bold">ğŸ“Š <span id="currentSelection">DBì†ë³´ 1ì£¼ì°¨</span> ë°ì´í„° ì…ë ¥</h2>
                            <button onclick="clearPasteArea()" class="px-4 py-2 bg-gray-500 text-white font-bold rounded-lg hover:bg-gray-600">
                                ğŸ—‘ï¸ ì´ˆê¸°í™”
                            </button>
                        </div>
                        
                        <textarea id="pasteArea" 
                                  class="paste-area w-full p-4 border-2 border-gray-300 rounded-xl" 
                                  placeholder="ì—‘ì…€ ë°ì´í„°ë¥¼ ì—¬ê¸°ì— ë¶™ì—¬ë„£ìœ¼ì„¸ìš”...&#10;&#10;ì˜ˆì‹œ:&#10;ìˆœìœ„	ì´ë¦„	ì‚¬ì—…ë¶€	ë³¸ë¶€	ì§€ì 	DBì±„ë„	ì˜ì—…ì‹œì‘ì›”	ì˜ì—…ì°¨ì›”	ê³„ì•½ê±´ìˆ˜	ì›”ë‚©ë³´í—˜ë£Œ	í‰ê°€ì—…ì &#10;1	ê¹€ì§„í›ˆ	ë””ì§€í„¸3ì‚¬ì—…ë¶€	ë””ì§€í„¸ê°•ë¶ë³¸ë¶€	ê°•ë¶4ì§€ì 	ë³´ì¥ë¶„ì„	2021/08	54.0	26	2222608	2061620&#10;&#10;âš ï¸ 'ì›”ë‚©ë³´í—˜ë£Œ' ì»¬ëŸ¼ì˜ ê°’ì´ ì‹œì±…ê¸ˆ ê³„ì‚°ì— ì‚¬ìš©ë©ë‹ˆë‹¤"></textarea>

                        <div class="mt-4 flex gap-3">
                            <button onclick="parseAndSaveData()" class="flex-1 px-6 py-4 bg-gradient-to-r from-purple-500 to-pink-500 text-white font-bold rounded-xl hover:shadow-lg transition-all">
                                ğŸ’¾ ë°ì´í„° íŒŒì‹± ë° ì €ì¥
                            </button>
                        </div>

                        <!-- íŒŒì‹±ëœ ë°ì´í„° ë¯¸ë¦¬ë³´ê¸° -->
                        <div id="previewSection" class="mt-6" style="display: none;">
                            <h3 class="text-lg font-bold mb-3">âœ… íŒŒì‹±ëœ ë°ì´í„° ë¯¸ë¦¬ë³´ê¸°</h3>
                            <div class="bg-green-50 border-2 border-green-200 rounded-xl p-4">
                                <p class="text-sm text-gray-700 mb-2">
                                    <strong>ì´ <span id="totalRows">0</span>ëª…ì˜ ë°ì´í„°ê°€ íŒŒì‹±ë˜ì—ˆìŠµë‹ˆë‹¤.</strong>
                                </p>
                                <div id="previewData" class="overflow-x-auto text-xs"></div>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- í˜„ì¬ ì €ì¥ëœ ë°ì´í„° í˜„í™© -->
                <section class="mb-8">
                    <div class="bg-white rounded-2xl p-6 card-shadow">
                        <h2 class="text-xl font-bold mb-4">ğŸ“ˆ í˜„ì¬ ì €ì¥ëœ ë°ì´í„° í˜„í™©</h2>
                        <div id="dataStatus" class="grid grid-cols-1 md:grid-cols-5 gap-4"></div>
                    </div>
                </section>

                <!-- ì¸ë³„ ë°ì´í„° ê´€ë¦¬ -->
                <section class="mb-8">
                    <div class="bg-white rounded-2xl p-6 card-shadow">
                        <h2 class="text-2xl font-bold mb-4 text-gray-800">ğŸ’¾ ì¸ë³„ ë°ì´í„° ê´€ë¦¬</h2>
                        
                        <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-4">
                            <button onclick="saveAllEmployeeData()" 
                                    class="px-6 py-4 bg-gradient-to-r from-purple-500 to-pink-500 text-white font-bold rounded-xl hover:shadow-lg transition-all">
                                ğŸ’¾ ì „ì²´ ì €ì¥
                            </button>
                            <button onclick="exportEmployeeData()" 
                                    class="px-6 py-4 bg-blue-500 text-white font-bold rounded-xl hover:bg-blue-600 transition-all">
                                ğŸ“¥ ì¸ë³„ ë°ì´í„° ë‹¤ìš´ë¡œë“œ
                            </button>
                            <button onclick="document.getElementById('importEmployeeFile').click()" 
                                    class="px-6 py-4 bg-green-500 text-white font-bold rounded-xl hover:bg-green-600 transition-all">
                                ğŸ“¤ ì¸ë³„ ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸°
                            </button>
                            <button onclick="clearAllEmployeeData()" 
                                    class="px-6 py-4 bg-red-500 text-white font-bold rounded-xl hover:bg-red-600 transition-all">
                                ğŸ—‘ï¸ ì „ì²´ ë°ì´í„° ì´ˆê¸°í™”
                            </button>
                        </div>
                        <input type="file" id="importEmployeeFile" accept=".json" style="display: none;" onchange="importEmployeeData(event)">
                        
                        <div class="p-4 bg-red-50 border-2 border-red-200 rounded-xl mb-4">
                            <p class="text-sm font-bold text-red-800 mb-2">âš ï¸ ì¤‘ìš”: ì›”ë‚©ë³´í—˜ë£Œ ê³„ì‚° ë°©ì‹ ë³€ê²½</p>
                            <p class="text-sm text-gray-700">
                                ì´ì „ ë²„ì „ì—ì„œ ì…ë ¥í•œ ë°ì´í„°ëŠ” <strong>ë°˜ì˜¬ë¦¼</strong>ìœ¼ë¡œ ì €ì¥ë˜ì–´ ìˆìŠµë‹ˆë‹¤.<br>
                                ì •í™•í•œ ê³„ì‚°ì„ ìœ„í•´ <strong class="text-red-600">"ì „ì²´ ë°ì´í„° ì´ˆê¸°í™”"</strong> í›„ ë°ì´í„°ë¥¼ ë‹¤ì‹œ ì…ë ¥í•´ì£¼ì„¸ìš”.<br>
                                (ì˜ˆ: 119,942ì› â†’ ê¸°ì¡´ 12ë§Œì› â†’ <strong class="text-blue-600">ìˆ˜ì • í›„ 11ë§Œì›</strong>)
                            </p>
                        </div>
                        
                        <div class="p-4 bg-yellow-50 border-2 border-yellow-200 rounded-xl">
                            <p class="text-sm text-gray-700">
                                ğŸ’¡ <strong>ì‚¬ìš© íŒ:</strong> ëª¨ë“  ë³´í—˜ì‚¬ì˜ ì£¼ì°¨ë³„ ë°ì´í„°ë¥¼ ì…ë ¥í•œ í›„ ë°˜ë“œì‹œ "ì „ì²´ ì €ì¥"ì„ ëˆŒëŸ¬ì£¼ì„¸ìš”!
                            </p>
                        </div>
                    </div>
                </section>
            </div>

        </main>
    </div>

    <!-- í‘¸í„° -->
    <footer class="gradient-bg text-white py-6 mt-12">
        <div class="container mx-auto px-4 text-center">
            <p class="text-sm opacity-80">Â© 2026 ë³´í—˜ì‚¬ ì‹œì±… ê³„ì‚°ê¸° | ì™„ì „ í†µí•© ë²„ì „</p>
        </div>
    </footer>

    <script>
        // í˜ì´ì§€ ì „í™˜
        let currentPage = 'calculator';
        let currentAdminTab = 'policy';
        let adminPassword = localStorage.getItem('admin_password') || 'admin1234';

        // í—¤ë” ë…„ì›” ì—…ë°ì´íŠ¸
        function updateHeaderMonth() {
            const month = insuranceData.currentMonth || '2026ë…„ 1ì›”';
            document.getElementById('headerSubtitle').textContent = `${month} ì‹œì±… ê³„ì‚° | ì¸ë³„ ì›”ë‚©ë³´í—˜ë£Œ ì¡°íšŒ`;
        }

        function togglePage() {
            if (currentPage === 'calculator') {
                // ê´€ë¦¬ì í˜ì´ì§€ë¡œ ì „í™˜ - ë¹„ë°€ë²ˆí˜¸ í™•ì¸
                const inputPassword = prompt('ğŸ”’ ê´€ë¦¬ì í˜ì´ì§€ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”:');
                if (inputPassword === null) return;
                if (inputPassword !== adminPassword) {
                    alert('âŒ ë¹„ë°€ë²ˆí˜¸ê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.');
                    return;
                }
                
                document.getElementById('calculatorPage').classList.remove('active');
                document.getElementById('adminPage').classList.add('active');
                document.getElementById('headerTitle').textContent = 'âš™ï¸ ë³´í—˜ì‚¬ ì‹œì±… ê´€ë¦¬ì';
                document.getElementById('headerSubtitle').textContent = 'ì‹œì±… ì„¤ì • ë° ì¸ë³„ ë°ì´í„° ê´€ë¦¬';
                document.getElementById('pageToggleBtn').innerHTML = '<span class="text-sm font-bold">ğŸ”™ ê³„ì‚°ê¸°ë¡œ ëŒì•„ê°€ê¸°</span>';
                document.getElementById('headerDesc').textContent = 'ëª¨ë“  ì„¤ì • í†µí•© ê´€ë¦¬';
                currentPage = 'admin';
                if (currentAdminTab === 'policy') {
                    showPolicyCompany(currentPolicyCompany);
                } else {
                    updateDataStatus();
                }
            } else {
                // ê³„ì‚°ê¸° í˜ì´ì§€ë¡œ ì „í™˜
                document.getElementById('adminPage').classList.remove('active');
                document.getElementById('calculatorPage').classList.add('active');
                document.getElementById('headerTitle').textContent = 'ğŸ’° ë³´í—˜ì‚¬ ì‹œì±… ê³„ì‚°ê¸°';
                updateHeaderMonth();
                document.getElementById('pageToggleBtn').innerHTML = '<span class="text-sm font-bold">âš™ï¸ ê´€ë¦¬ì í˜ì´ì§€</span>';
                document.getElementById('headerDesc').textContent = 'ì‚¬ì›ë³„ ì‹œì±…ê¸ˆ ìë™ ê³„ì‚°';
                currentPage = 'calculator';
            }
        }

        // ê´€ë¦¬ì ë¹„ë°€ë²ˆí˜¸ ë³€ê²½
        function changeAdminPassword() {
            const currentPw = prompt('ğŸ”’ í˜„ì¬ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”:');
            if (currentPw === null) return;
            if (currentPw !== adminPassword) {
                alert('âŒ í˜„ì¬ ë¹„ë°€ë²ˆí˜¸ê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.');
                return;
            }
            const newPw = prompt('ğŸ”‘ ìƒˆ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”:');
            if (newPw === null || newPw.trim() === '') return;
            if (newPw.length < 4) {
                alert('âŒ ë¹„ë°€ë²ˆí˜¸ëŠ” ìµœì†Œ 4ì ì´ìƒì´ì–´ì•¼ í•©ë‹ˆë‹¤.');
                return;
            }
            const confirmPw = prompt('ğŸ”‘ ìƒˆ ë¹„ë°€ë²ˆí˜¸ë¥¼ ë‹¤ì‹œ ì…ë ¥í•˜ì„¸ìš”:');
            if (confirmPw === null) return;
            if (newPw !== confirmPw) {
                alert('âŒ ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.');
                return;
            }
            adminPassword = newPw;
            localStorage.setItem('admin_password', newPw);
            showToast('âœ… ë¹„ë°€ë²ˆí˜¸ê°€ ì„±ê³µì ìœ¼ë¡œ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤!', 'success');
        }

        // ê´€ë¦¬ì íƒ­ ì „í™˜
        function switchAdminTab(tab) {
            currentAdminTab = tab;
            
            // íƒ­ ë²„íŠ¼ ìŠ¤íƒ€ì¼
            document.querySelectorAll('[id^="admin-tab-"]').forEach(btn => {
                btn.classList.remove('active');
                btn.classList.add('bg-gray-50');
            });
            document.getElementById(`admin-tab-${tab}`).classList.add('active');
            document.getElementById(`admin-tab-${tab}`).classList.remove('bg-gray-50');
            
            // íƒ­ ì»¨í…ì¸  ì „í™˜
            document.querySelectorAll('.admin-tab').forEach(tabContent => {
                tabContent.classList.remove('active');
            });
            
            if (tab === 'policy') {
                document.getElementById('policyTab').classList.add('active');
            } else {
                document.getElementById('employeeTab').classList.add('active');
            }
        }

        // ë³´í—˜ì‚¬ ì‹œì±… ë°ì´í„°
        let insuranceData = {
            currentMonth: '2026ë…„ 1ì›”',
            db: {
                name: 'DBì†í•´ë³´í—˜',
                monthlyRate: 100,
                petRate: 150,
                baekbaek: {
                    50: 20,
                    100: 100,
                    200: 200,
                    300: 300,
                    400: 400,
                    500: 500,
                    600: 600,
                    700: 700,
                    800: 800,
                    900: 900,
                    1000: 1000
                },
                weekly: {
                    week1: {
                        dateRange: '1/1~1/8',
                        company: { 10: 10, 20: 20, 30: 30, 50: 50 },
                        self: { 10: 50, 20: 100, 30: 150, 50: 250, 70: 350, 100: 500 },
                        consecutive: {
                            desc: '12.15~12.31 + 1.1~1.18',
                            week1: 'week0',
                            week2: 'week1',
                            tiers: { 10: 20, 20: 60, 30: 80, 50: 180 }
                        }
                    },
                    week2: {
                        dateRange: '1/9~1/15',
                        company: { 10: 10, 20: 20, 30: 30, 50: 50 },
                        self: { 10: 40, 20: 80, 30: 120, 50: 200, 70: 280, 100: 400 },
                        consecutive: {
                            desc: '12.15~12.31 + 1.1~1.18',
                            week1: 'week0',
                            week2: 'week1',
                            tiers: { 10: 20, 20: 60, 30: 80, 50: 180 }
                        }
                    },
                    week3: {
                        dateRange: '1/16~1/22',
                        company: { 10: 10, 20: 20, 30: 30, 50: 50 },
                        self: { 10: 30, 20: 60, 30: 120, 50: 200, 70: 280, 100: 400 },
                        consecutive: {
                            desc: '1.19~1.31 + 2.1~2.18',
                            week1: 'week3',
                            week2: 'week4',
                            tiers: { 10: 20, 20: 60, 30: 80, 50: 180 }
                        }
                    },
                    week4: {
                        dateRange: '1/23~1/31',
                        company: { 10: 10, 20: 20, 30: 30, 50: 50, 70: 70, 100: 100 },
                        self: { 10: 10, 20: 20, 30: 30, 50: 50, 70: 70, 100: 100 },
                        consecutive: {
                            desc: '1.26~1.31 + 2.1~2.8',
                            week1: 'week4',
                            week2: 'week5',
                            tiers: { 10: 20, 20: 60, 30: 80, 50: 180 }
                        },
                        consecutive4week: {
                            desc: '4ì£¼ ì—°ì†ì¶”ê°€ (1.26~1.31 + 2.1~2.8)',
                            tiers: { 10: 30, 20: 45, 30: 80, 50: 120 }
                        },
                        gift: {
                            desc: 'ë¬¼í’ˆì‹œìƒ (1.26~1.31 + 2.1~2.8)',
                            tiers: { 10: 20, 20: 50, 30: 100, 50: 200 }
                        }
                    }
                }
            },
            heungkuk: {
                name: 'í¥êµ­í™”ì¬',
                monthlyRate: 100,
                selfMonthlyRate: 450,
                baekbaek: {
                    50: 30,
                    100: 100,
                    200: 200,
                    300: 300,
                    400: 400,
                    500: 500,
                    600: 600,
                    700: 700,
                    800: 800,
                    900: 900,
                    1000: 1000
                },
                weekly: {
                    week1: {
                        dateRange: '1/1~1/8',
                        company: { 10: 10, 20: 20, 30: 45, 50: 75 },
                        self: { 10: 50, 20: 100, 30: 150, 50: 250, 70: 350, 100: 500 },
                        consecutive: {
                            desc: 'â‘  12.29~1.11 / â‘¡ 1.1~1.18',
                            week1: 'week0',
                            week2: 'week1',
                            tiers: { 10: 60, 20: 120, 30: 180, 50: 300 }
                        }
                    },
                    week2: {
                        dateRange: '1/9~1/15',
                        company: { 10: 10, 20: 20, 30: 45, 50: 75 },
                        self: { 10: 40, 20: 80, 30: 120, 50: 200, 70: 280, 100: 400 },
                        consecutive: {
                            desc: 'â‘  1.1~1.18 / â‘¡ 1.12~1.25',
                            week1: 'week1',
                            week2: 'week2',
                            tiers: { 10: 60, 20: 120, 30: 180, 50: 300 }
                        }
                    },
                    week3: {
                        dateRange: '1/16~1/22',
                        company: { 10: 10, 20: 20, 30: 30, 50: 50 },
                        self: { 10: 30, 20: 60, 30: 120, 50: 200, 70: 280, 100: 400 },
                        consecutive: {
                            desc: 'â‘  1.12~1.25 / â‘¡ 1.19~1.31',
                            week1: 'week2',
                            week2: 'week3',
                            tiers: { 10: 60, 20: 120, 30: 180, 50: 300 }
                        }
                    },
                    week4: {
                        dateRange: '1/23~1/31',
                        company: { 10: 5, 20: 10, 30: 30, 50: 50 },
                        self: { 10: 10, 20: 20, 30: 30, 50: 50, 70: 70, 100: 100 },
                        consecutive: {
                            desc: 'â‘  1.19~1.31 / â‘¡ 1.26~2.8',
                            week1: 'week3',
                            week2: 'week4',
                            tiers: { 10: 60, 20: 120, 30: 180, 50: 300 }
                        }
                    }
                }
            },
            meritz: {
                name: 'ë©”ë¦¬ì¸ í™”ì¬',
                monthlyRate: 100,
                weekly: {
                    week1: {
                        dateRange: '1/1~1/8',
                        company: { 10: 20, 20: 40, 30: 60, 50: 100, 100: 200 },
                        self: { 10: 25, 20: 50, 30: 75, 50: 125, 100: 250 },
                        consecutive: {
                            desc: '12/15~31 + 1/1~18',
                            week1: 'week0',
                            week2: 'week1',
                            tiers: { 10: 20, 20: 60, 30: 80, 50: 180 }
                        }
                    },
                    week2: {
                        dateRange: '1/9~1/15',
                        company: { 10: 20, 20: 40, 30: 60, 50: 100, 100: 200 },
                        self: { 10: 25, 20: 50, 30: 75, 50: 125, 100: 250 },
                        consecutive: {
                            desc: '12/15~31 + 1/1~18',
                            week1: 'week0',
                            week2: 'week1',
                            tiers: { 10: 20, 20: 60, 30: 80, 50: 180 }
                        }
                    },
                    week3: {
                        dateRange: '1/16~1/22',
                        company: { 10: 20, 20: 40, 30: 60, 50: 100, 100: 200 },
                        self: { 10: 25, 20: 50, 30: 75, 50: 125, 100: 250 },
                        consecutive: {
                            desc: '1/19~31 + 2/1~18',
                            week1: 'week3',
                            week2: 'week4',
                            tiers: { 10: 20, 20: 60, 30: 80, 50: 180 }
                        }
                    },
                    week4: {
                        dateRange: '1/23~1/31',
                        company: { 10: 10, 20: 20, 30: 30, 50: 50, 100: 100 },
                        self: { 10: 25, 20: 50, 30: 75, 50: 125, 100: 250 },
                        consecutive: {
                            desc: 'ì—°ì†ê°€ë™â‘  (1/19~31 + 2/1~18)',
                            week1: 'week3',
                            week2: 'week4',
                            tiers: { 10: 20, 20: 60, 30: 80, 50: 180 }
                        },
                        consecutive4week: {
                            desc: 'ì—°ì† ì¶”ê°€ (1/26~31 + 2/1~18)',
                            tiers: { 10: 20, 20: 45, 30: 80, 50: 180 }
                        }
                    }
                }
            },
            kb: {
                name: 'KBì†í•´ë³´í—˜',
                monthlyRate: 120,
                petRate: 300,
                baekbaek: {
                    50: 25,
                    100: 100,
                    200: 200,
                    300: 300,
                    400: 400,
                    500: 500,
                    600: 600,
                    700: 700,
                    800: 800,
                    900: 900,
                    1000: 1000
                },
                weekly: {
                    week1: {
                        dateRange: '1/1~1/8',
                        company: { 10: 10, 20: 20, 30: 30, 50: 50 },
                        self: { 50: 20, 100: 100, 200: 200, 300: 300, 1000: 1000 },
                        consecutive: {
                            desc: '12, 1ì›” ì£¼ì°¨ ì—°ì†ê°€ë™ (12/15~31 + 1/1~18)',
                            week1: 'week0',
                            week2: 'week1',
                            tiers: { 10: 20, 20: 60, 30: 80, 50: 180 }
                        }
                    },
                    week2: {
                        dateRange: '1/9~1/15',
                        company: { 10: 10, 20: 20, 30: 30, 50: 50 },
                        self: { 10: 40, 20: 80, 30: 120, 50: 200, 70: 280 },
                        consecutive: {
                            desc: '12, 1ì›” ì£¼ì°¨ ì—°ì†ê°€ë™ (12/15~31 + 1/1~18)',
                            week1: 'week0',
                            week2: 'week1',
                            tiers: { 10: 20, 20: 60, 30: 80, 50: 180 }
                        }
                    },
                    week3: {
                        dateRange: '1/16~1/22',
                        company: { 10: 10, 20: 20, 30: 30, 50: 50 },
                        self: { 10: 30, 20: 60, 30: 90, 50: 150, 70: 210 },
                        consecutive: {
                            desc: '1, 2ì›” ì£¼ì°¨ ì—°ì†ê°€ë™ (1/19~31 + 2/1~18)',
                            week1: 'week3',
                            week2: 'week4',
                            tiers: { 10: 20, 20: 60, 30: 80, 50: 180 }
                        }
                    },
                    week4: {
                        dateRange: '1/23~1/31',
                        company: { 10: 5, 20: 10, 30: 30, 50: 50 },
                        self: { 10: 10, 20: 20, 30: 30, 50: 50 },
                        consecutive: {
                            desc: 'â‘  1, 2ì›” ì£¼ì°¨ ì—°ì†ê°€ë™ (1/19~31 + 2/1~18)',
                            week1: 'week3',
                            week2: 'week4',
                            tiers: { 10: 20, 20: 60, 30: 80, 50: 180 }
                        },
                        consecutive4week: {
                            desc: 'â‘¡ ì—°ì†ì¶”ê°€ (1/26~31 + 2/1~8)',
                            tiers: { 10: 30, 20: 45, 30: 80, 50: 120 }
                        }
                    }
                }
            },
            monthly: {
                name: 'ì´ë‹¬ì£¼ë ¥ì‚¬',
                displayName: 'ì´ë‹¬ì£¼ë ¥ì‚¬',
                monthlyRate: 100,
                weekly: {
                    week1: {
                        company: { 10: 15, 20: 30, 30: 45, 50: 75 },
                        self: { 10: 60, 20: 120, 30: 180, 50: 300, 70: 420, 100: 600 }
                    },
                    week2: {
                        company: { 10: 15, 20: 30, 30: 45, 50: 75 },
                        self: { 10: 50, 20: 100, 30: 150, 50: 250, 70: 350, 100: 500 }
                    },
                    week3: {
                        company: { 10: 15, 20: 30, 30: 45, 50: 75 },
                        self: { 10: 40, 20: 80, 30: 120, 50: 200, 70: 280, 100: 400 }
                    },
                    week4: {
                        company: { 10: 10, 20: 20, 30: 30, 50: 50 },
                        self: { 10: 20, 20: 40, 30: 60, 50: 100, 70: 140, 100: 200 }
                    }
                }
            }
        };

        // ì‚¬ì› ë°ì´í„°
        let employeeData = {
            db: { week0: [], week1: [], week2: [], week3: [], week4: [] },
            heungkuk: { week0: [], week1: [], week2: [], week3: [], week4: [] },
            meritz: { week0: [], week1: [], week2: [], week3: [], week4: [] },
            kb: { week0: [], week1: [], week2: [], week3: [], week4: [] },
            monthly: { week0: [], week1: [], week2: [], week3: [], week4: [] }
        };

        let currentCompany = null;
        let selectedEmployee = null;
        let currentPolicyCompany = 'db';
        let currentEmployeeCompany = 'db';
        let currentWeek = 1;

        const companyNames = {
            db: 'DBì†ë³´',
            heungkuk: 'í¥êµ­í™”ì¬',
            meritz: 'ë©”ë¦¬ì¸ í™”ì¬',
            kb: 'KBì†ë³´',
            monthly: 'ì´ë‹¬ì£¼ë ¥ì‚¬'
        };

        // ==================== ê³„ì‚°ê¸° í˜ì´ì§€ ====================

        // ë³´í—˜ì‚¬ ì„ íƒ
        function selectCompany(company) {
            currentCompany = company;
            selectedEmployee = null;
            
            // ëª¨ë“  ë²„íŠ¼ ì´ˆê¸°í™”
            document.querySelectorAll('.company-btn').forEach(btn => {
                btn.classList.remove('selected');
            });
            
            // ì„ íƒëœ ë²„íŠ¼ ê°•ì¡°
            document.getElementById(`btn-${company}`).classList.add('selected');
            
            // ê²€ìƒ‰ ì„¹ì…˜ í‘œì‹œ
            document.getElementById('searchSection').style.display = 'block';
            document.getElementById('employeeInfo').style.display = 'none';
            document.getElementById('resultSection').style.display = 'none';
            
            // í•„í„° ì´ˆê¸°í™”
            loadBranches();
            filterEmployees();
        }

        // ë³¸ë¶€ ëª©ë¡ ë¡œë“œ
        function loadBranches() {
            const branches = new Set();
            
            for (let week = 1; week <= 4; week++) {
                employeeData[currentCompany][`week${week}`].forEach(emp => {
                    if (emp.branch) branches.add(emp.branch);
                });
            }
            
            const branchSelect = document.getElementById('branchSelect');
            branchSelect.innerHTML = '<option value="">ì „ì²´</option>';
            
            Array.from(branches).sort().forEach(branch => {
                branchSelect.innerHTML += `<option value="${branch}">${branch}</option>`;
            });
        }

        // ì§€ì  í•„í„°ë§
        function filterOffices() {
            const selectedBranch = document.getElementById('branchSelect').value;
            const offices = new Set();
            
            for (let week = 1; week <= 4; week++) {
                employeeData[currentCompany][`week${week}`].forEach(emp => {
                    if (!selectedBranch || emp.branch === selectedBranch) {
                        if (emp.office) offices.add(emp.office);
                    }
                });
            }
            
            const officeSelect = document.getElementById('officeSelect');
            officeSelect.innerHTML = '<option value="">ì „ì²´</option>';
            
            Array.from(offices).sort().forEach(office => {
                officeSelect.innerHTML += `<option value="${office}">${office}</option>`;
            });
            
            filterEmployees();
        }

        // ì‚¬ì› í•„í„°ë§
        function filterEmployees() {
            const selectedBranch = document.getElementById('branchSelect').value;
            const selectedOffice = document.getElementById('officeSelect').value;
            const searchName = document.getElementById('nameSearch').value.toLowerCase();
            
            // ëª¨ë“  ì£¼ì°¨ì—ì„œ ì‚¬ì› ë°ì´í„° ìˆ˜ì§‘ (ì¤‘ë³µ ì œê±°)
            const employeeMap = new Map();
            
            for (let week = 1; week <= 4; week++) {
                employeeData[currentCompany][`week${week}`].forEach(emp => {
                    const key = `${emp.name}_${emp.branch}_${emp.office}`;
                    
                    if (!employeeMap.has(key)) {
                        employeeMap.set(key, {
                            name: emp.name,
                            dept: emp.dept,
                            branch: emp.branch,
                            office: emp.office,
                            weeks: {}
                        });
                    }
                    
                    employeeMap.get(key).weeks[`week${week}`] = emp.amount;
                });
            }
            
            // í•„í„°ë§
            const filtered = Array.from(employeeMap.values()).filter(emp => {
                if (selectedBranch && emp.branch !== selectedBranch) return false;
                if (selectedOffice && emp.office !== selectedOffice) return false;
                if (searchName && !emp.name.toLowerCase().includes(searchName)) return false;
                return true;
            });
            
            // ê²°ê³¼ í‘œì‹œ
            displaySearchResults(filtered);
        }

        // ê²€ìƒ‰ ê²°ê³¼ í‘œì‹œ
        function displaySearchResults(employees) {
            const resultsDiv = document.getElementById('searchResults');
            
            if (employees.length === 0) {
                resultsDiv.innerHTML = '<p class="text-gray-500 text-center py-8">ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤</p>';
                document.getElementById('bulkPrintSection').style.display = 'none';
                return;
            }
            
            // ì¼ê´„ ì¸ì‡„ ì„¹ì…˜ í‘œì‹œ
            document.getElementById('bulkPrintSection').style.display = 'block';
            
            let html = `<p class="text-sm text-gray-600 mb-3">ì´ <strong>${employees.length}ëª…</strong>ì˜ ì‚¬ì›ì´ ê²€ìƒ‰ë˜ì—ˆìŠµë‹ˆë‹¤</p>`;
            html += '<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3 max-h-96 overflow-y-auto">';
            
            employees.forEach((emp, index) => {
                const weekCount = Object.keys(emp.weeks).length;
                const totalAmount = Object.values(emp.weeks).reduce((a, b) => a + b, 0);
                const empId = `emp_${index}`;
                
                html += `
                    <div class="employee-card bg-gray-50 p-4 rounded-xl border-2 border-gray-200 relative">
                        <div class="absolute top-2 right-2">
                            <input type="checkbox" class="employee-checkbox w-5 h-5 cursor-pointer" 
                                   id="${empId}" 
                                   data-employee='${JSON.stringify(emp).replace(/'/g, "&apos;")}'
                                   onchange="updateSelectedCount()">
                        </div>
                        <div onclick='selectEmployee(${JSON.stringify(emp).replace(/'/g, "&apos;")})' class="cursor-pointer">
                            <h3 class="font-bold text-lg mb-1 pr-8">${emp.name}</h3>
                            <p class="text-sm text-gray-600">${emp.branch}</p>
                            <p class="text-sm text-gray-600 mb-2">${emp.office}</p>
                            <div class="flex justify-between items-center text-xs">
                                <span class="text-gray-500">${weekCount}ì£¼ì°¨ ë°ì´í„°</span>
                                <span class="font-bold text-purple-600">${totalAmount}ë§Œì›</span>
                            </div>
                        </div>
                    </div>
                `;
            });
            
            html += '</div>';
            resultsDiv.innerHTML = html;
            updateSelectedCount();
        }

        // ì‚¬ì› ì„ íƒ
        function selectEmployee(employee) {
            selectedEmployee = employee;
            
            // ì‚¬ì› ì •ë³´ í‘œì‹œ
            document.getElementById('selectedName').textContent = employee.name;
            document.getElementById('selectedDept').textContent = employee.dept || '-';
            document.getElementById('selectedBranch').textContent = employee.branch;
            document.getElementById('selectedOffice').textContent = employee.office;
            
            // íšŒì‚¬ëª… ì„¤ì •
            const companyName = companyNames[currentCompany] || '';
            document.getElementById('weeklyCompanyName').textContent = companyName;
            
            document.getElementById('employeeInfo').style.display = 'block';
            
            // ì£¼ì°¨ë³„ ë°ì´í„° ë° ì‹œì±…ê¸ˆ ê³„ì‚°
            calculateAllWeeks(employee);
            
            // ìŠ¤í¬ë¡¤
            document.getElementById('employeeInfo').scrollIntoView({ behavior: 'smooth', block: 'start' });
        }

        // ì „ì²´ ì£¼ì°¨ ê³„ì‚°
        function calculateAllWeeks(employee) {
            const data = insuranceData[currentCompany];
            let weeklyHTML = '';
            let totalReward = 0;
            let totalAmount = 0;
            let detailHTML = '';
            
            // ì£¼ì°¨ë³„ ê¸ˆì•¡ ì €ì¥
            const weekAmounts = {
                week0: employee.weeks.week0 || 0,
                week1: employee.weeks.week1 || 0,
                week2: employee.weeks.week2 || 0,
                week3: employee.weeks.week3 || 0,
                week4: employee.weeks.week4 || 0
            };
            
            // ì—°ì†ê°€ë™ ì‹œìƒ í”Œë˜ê·¸ (í•œ ë²ˆë§Œ ì§€ê¸‰)
            let hasConsecutiveReward = false;
            const consecutive4DescAchieved = new Set();
            const giftDescAchieved = new Set();
            
            // ì—°ì†ê°€ë™ ì‹œìƒê¸ˆ ê³„ì‚° í•¨ìˆ˜ (week1, week2 ê¸°ë°˜)
            function checkConsecutiveReward(weekData, weekNum, companyName) {
                if (!weekData.consecutive || !weekData.consecutive.tiers) {
                    return { reward: 0, status: '' };
                }
                
                // ì´ë¯¸ ì§€ê¸‰ë˜ì—ˆìœ¼ë©´ ë” ì´ìƒ ì§€ê¸‰í•˜ì§€ ì•ŠìŒ
                if (hasConsecutiveReward) {
                    return { reward: 0, status: '' };
                }
                
                const consDesc = weekData.consecutive.desc || '';
                const consTiers = Object.keys(weekData.consecutive.tiers).map(Number).sort((a, b) => b - a);
                
                // week1, week2ê°€ ìˆìœ¼ë©´ ë‘ ì£¼ì°¨ ëª¨ë‘ ì²´í¬
                if (weekData.consecutive.week1 && weekData.consecutive.week2) {
                    const week1Amount = weekAmounts[weekData.consecutive.week1] || 0;
                    const week2Amount = weekAmounts[weekData.consecutive.week2] || 0;
                    
                    for (let tier of consTiers) {
                        let isAchieved = false;
                        
                        // í¥êµ­í™”ì¬: ë‘ ì£¼ì°¨ ëª¨ë‘ ë™ì¼ êµ¬ê°„ ë‹¬ì„±
                        if (companyName === 'í¥êµ­í™”ì¬') {
                            const minAmount = Math.min(week1Amount, week2Amount);
                            isAchieved = minAmount >= tier;
                        } 
                        // DBì†ë³´, KBì†ë³´, ë©”ë¦¬ì¸ : í•œìª½ì€ êµ¬ê°„, ë‹¤ë¥¸ ìª½ì€ 10ë§Œì› ì´ìƒ
                        else {
                            isAchieved = (week1Amount >= tier && week2Amount >= 10) || 
                                        (week1Amount >= 10 && week2Amount >= tier);
                        }
                        
                        if (isAchieved) {
                            hasConsecutiveReward = true;
                            return {
                                reward: weekData.consecutive.tiers[tier],
                                status: `âœ“ ì—°ì†ê°€ë™ ë‹¬ì„± (${consDesc})`
                            };
                        }
                    }
                    return { reward: 0, status: '' };
                }
                
                // week1, week2ê°€ ì—†ìœ¼ë©´ ê¸°ì¡´ ë°©ì‹ (í˜„ì¬ ì£¼ì°¨ë§Œ ì²´í¬)
                const amount = weekAmounts[`week${weekNum}`] || 0;
                for (let tier of consTiers) {
                    if (amount >= tier) {
                        hasConsecutiveReward = true;
                        return {
                            reward: weekData.consecutive.tiers[tier],
                            status: `âœ“ ì—°ì†ê°€ë™ 1ì°¨ ë‹¬ì„± (${consDesc})`
                        };
                    }
                }
                return { reward: 0, status: '' };
            }
            
            for (let week = 1; week <= 4; week++) {
                const amount = employee.weeks[`week${week}`] || 0;
                totalAmount += amount;
                
                if (amount === 0) {
                    weeklyHTML += `
                        <div class="bg-gray-50 p-4 rounded-xl border-2 border-gray-200">
                            <h4 class="font-bold mb-2">${week}ì£¼ì°¨</h4>
                            <p class="text-sm text-gray-500">ë°ì´í„° ì—†ìŒ</p>
                        </div>
                    `;
                    continue;
                }
                
                // ì‹œì±…ê¸ˆ ê³„ì‚°
                const weekData = data.weekly[`week${week}`];
                
                // ì›”ì‹œì±…
                const basicReward = Math.round(amount * (data.monthlyRate / 100));
                
                // ë³´í—˜ì‚¬ ì‹œìƒ
                let companyReward = 0;
                const companyTiers = Object.keys(weekData.company).map(Number).sort((a, b) => b - a);
                for (let tier of companyTiers) {
                    if (amount >= tier) {
                        companyReward = weekData.company[tier];
                        break;
                    }
                }
                
                // ìì²´ ì‹œìƒ
                let selfReward = 0;
                const selfTiers = Object.keys(weekData.self).map(Number).sort((a, b) => b - a);
                for (let tier of selfTiers) {
                    if (amount >= tier) {
                        selfReward = weekData.self[tier];
                        break;
                    }
                }
                
                // ì—°ì†ê°€ë™ ì‹œìƒ (week1, week2 ê¸°ë°˜ìœ¼ë¡œ ê³„ì‚°)
                const consecutiveResult = checkConsecutiveReward(weekData, week, data.name);
                const consecutiveReward = consecutiveResult.reward;
                const consecutiveStatus = consecutiveResult.status;
                
                // 4ì£¼ ì—°ì†ì¶”ê°€ ì‹œìƒ (ì¤‘ë³µ ë°©ì§€)
                let consecutive4Reward = 0;
                let consecutive4Status = '';
                if (weekData.consecutive4week && weekData.consecutive4week.tiers) {
                    const cons4Desc = weekData.consecutive4week.desc || '';
                    const cons4Tiers = Object.keys(weekData.consecutive4week.tiers).map(Number).sort((a, b) => b - a);
                    for (let tier of cons4Tiers) {
                        if (amount >= tier) {
                            if (!consecutive4DescAchieved.has(cons4Desc)) {
                                consecutive4Reward = weekData.consecutive4week.tiers[tier];
                                consecutive4DescAchieved.add(cons4Desc);
                                consecutive4Status = `âœ“ 4ì£¼ ì—°ì†ì¶”ê°€ 1ì°¨ ë‹¬ì„±`;
                            } else {
                                consecutive4Status = `âœ“ 4ì£¼ ì—°ì†ì¶”ê°€ ë‹¬ì„± (ì´ë¯¸ ì ìš©ë¨)`;
                            }
                            break;
                        }
                    }
                }
                
                // ë¬¼í’ˆì‹œìƒ (ì¤‘ë³µ ë°©ì§€)
                let giftReward = 0;
                let giftStatus = '';
                if (weekData.gift && weekData.gift.tiers) {
                    const giftDesc = weekData.gift.desc || '';
                    const giftTiers = Object.keys(weekData.gift.tiers).map(Number).sort((a, b) => b - a);
                    for (let tier of giftTiers) {
                        if (amount >= tier) {
                            if (!giftDescAchieved.has(giftDesc)) {
                                giftReward = weekData.gift.tiers[tier];
                                giftDescAchieved.add(giftDesc);
                                giftStatus = `âœ“ ë¬¼í’ˆì‹œìƒ 1ì°¨ ë‹¬ì„±`;
                            } else {
                                giftStatus = `âœ“ ë¬¼í’ˆì‹œìƒ ë‹¬ì„± (ì´ë¯¸ ì ìš©ë¨)`;
                            }
                            break;
                        }
                    }
                }
                
                const weekTotal = basicReward + companyReward + selfReward + consecutiveReward + consecutive4Reward + giftReward;
                totalReward += weekTotal;
                
                // ì‹œë®¬ë ˆì´ì…˜: ë‹¤ìŒ êµ¬ê°„ ë‹¬ì„± ì‹œ ì‹œì±…ê¸ˆ ê³„ì‚°
                let simulationHTML = '';
                
                // ëª¨ë“  tier ìˆ˜ì§‘ (ì¤‘ë³µ ì œê±°)
                const allTiers = new Set();
                Object.keys(weekData.company).forEach(t => allTiers.add(Number(t)));
                Object.keys(weekData.self).forEach(t => allTiers.add(Number(t)));
                
                // í˜„ì¬ amountë³´ë‹¤ í° tierë§Œ í•„í„°ë§í•˜ê³  ì •ë ¬
                const nextTiers = Array.from(allTiers)
                    .filter(t => t > amount)
                    .sort((a, b) => a - b)
                    .slice(0, 2); // ê°€ì¥ ê°€ê¹Œìš´ 2ê°œë§Œ
                
                if (nextTiers.length > 0) {
                    simulationHTML = '<div class="mt-3 space-y-2 no-print">';
                    
                    nextTiers.forEach((nextTier, index) => {
                        // ë‹¤ìŒ tier ì‹œì±…ê¸ˆ ê³„ì‚°
                        const nextBasicReward = Math.round(nextTier * (data.monthlyRate / 100));
                        
                        let nextCompanyReward = 0;
                        for (let tier of companyTiers) {
                            if (nextTier >= tier) {
                                nextCompanyReward = weekData.company[tier];
                                break;
                            }
                        }
                        
                        let nextSelfReward = 0;
                        for (let tier of selfTiers) {
                            if (nextTier >= tier) {
                                nextSelfReward = weekData.self[tier];
                                break;
                            }
                        }
                        
                        // ì—°ì†ê°€ë™ì€ í˜„ì¬ì™€ ë™ì¼í•˜ê²Œ ìœ ì§€ (ì¡°ê±´ë¶€ì´ë¯€ë¡œ)
                        const nextTotal = nextBasicReward + nextCompanyReward + nextSelfReward + consecutiveReward + consecutive4Reward + giftReward;
                        const challenge = nextTier - amount;
                        const rewardIncrease = nextTotal - weekTotal;
                        
                        const bgColor = index === 0 ? 'bg-red-50 border-red-300' : 'bg-orange-50 border-orange-300';
                        const textColor = index === 0 ? 'text-red-700' : 'text-orange-700';
                        const label = index === 0 ? 'êµ¬ê°„ ë‹¬ì„±ì‹œ ì´ ì‹œì±…ê¸ˆ' : 'ë‹¤ìŒ êµ¬ê°„ ì´ ì‹œì±…ê¸ˆ';
                        const arrow = index === 0 ? 'â†’' : 'â†’â†’';
                        
                        simulationHTML += `
                            <div class="p-3 ${bgColor} border-2 rounded-lg">
                                <div class="flex items-center justify-between mb-2">
                                    <span class="text-xs font-bold ${textColor}">${arrow} ${label}</span>
                                    <span class="text-lg font-bold ${textColor}">${nextTotal}ë§Œì›</span>
                                </div>
                                <div class="text-xs text-gray-600 space-y-1">
                                    <div>ê¸°ì¡´ ë³´í—˜ë£Œ: <span class="font-bold">${nextTier}ë§Œì›</span> | ë„ì „: <span class="font-bold ${textColor}">+${challenge}ë§Œì›</span></div>
                                    <div>ì‹œì±…ê¸ˆ ì¦ê°€: <span class="font-bold ${textColor}">+${rewardIncrease}ë§Œì›</span> (ì›”ì‹œì±… ${nextBasicReward-basicReward}ë§Œ + ì£¼ê°„ ${nextCompanyReward-companyReward}ë§Œ + êµ¿ë¦¬ì¹˜ ${nextSelfReward-selfReward}ë§Œ)</div>
                                </div>
                            </div>
                        `;
                    });
                    
                    simulationHTML += '</div>';
                }
                
                weeklyHTML += `
                    <div class="bg-green-50 p-4 rounded-xl border-2 border-green-200">
                        <h4 class="font-bold mb-2">${week}ì£¼ì°¨${weekData.dateRange ? ` (${weekData.dateRange})` : ''}</h4>
                        <p class="text-sm text-gray-600">ì›”ë‚©ë³´í—˜ë£Œ: <span class="font-bold text-purple-600">${amount}ë§Œì›</span></p>
                        <p class="text-sm text-gray-600">ì‹œì±…ê¸ˆ: <span class="font-bold text-green-600">${weekTotal}ë§Œì›</span></p>
                        <div class="mt-2 text-xs text-gray-500">
                            <div>ì›”ì‹œì±…(ìµì›”): ${basicReward}ë§Œ</div>
                            <div>ì£¼ê°„: ${companyReward}ë§Œ</div>
                            <div>êµ¿ë¦¬ì¹˜(ìµì›”): ${selfReward}ë§Œ</div>
                            ${consecutiveReward > 0 ? `<div class="text-orange-600 font-bold">ì—°ì†ê°€ë™: ${consecutiveReward}ë§Œ</div>` : ''}
                            ${consecutive4Reward > 0 ? `<div class="text-red-600 font-bold">4ì£¼ì—°ì†: ${consecutive4Reward}ë§Œ</div>` : ''}
                            ${giftReward > 0 ? `<div class="text-blue-600 font-bold">ë¬¼í’ˆì‹œìƒ: ${giftReward}ë§Œ</div>` : ''}
                        </div>
                        ${consecutiveStatus ? `<div class="mt-2 text-xs text-orange-600 font-bold">${consecutiveStatus}</div>` : ''}
                        ${consecutive4Status ? `<div class="mt-1 text-xs text-red-600 font-bold">${consecutive4Status}</div>` : ''}
                        ${giftStatus ? `<div class="mt-1 text-xs text-blue-600 font-bold">${giftStatus}</div>` : ''}
                        ${simulationHTML}
                    </div>
                `;
                
                detailHTML += `
                    <div class="bg-white p-4 rounded-xl border-2 border-gray-200">
                        <h4 class="font-bold mb-3 text-purple-600">${week}ì£¼ì°¨${weekData.dateRange ? ` (${weekData.dateRange})` : ''}</h4>
                        <div class="space-y-2 text-sm">
                            <div class="flex justify-between">
                                <span>ì›”ë‚©ë³´í—˜ë£Œ</span>
                                <span class="font-bold">${amount}ë§Œì›</span>
                            </div>
                            <div class="flex justify-between text-blue-600">
                                <span>ì›”ì‹œì±…(ìµì›”) (${data.monthlyRate}%)</span>
                                <span class="font-bold">${basicReward}ë§Œì›</span>
                            </div>
                            <div class="flex justify-between text-green-600">
                                <span>ì£¼ê°„ì‹œìƒ</span>
                                <span class="font-bold">${companyReward}ë§Œì›</span>
                            </div>
                            <div class="flex justify-between text-purple-600">
                                <span>êµ¿ë¦¬ì¹˜ì£¼ê°„(ìµì›”)</span>
                                <span class="font-bold">${selfReward}ë§Œì›</span>
                            </div>
                            ${consecutiveReward > 0 ? `
                            <div class="flex justify-between text-orange-600">
                                <span>ì—°ì†ê°€ë™ (ì¡°ê±´ë¶€)</span>
                                <span class="font-bold">${consecutiveReward}ë§Œì›</span>
                            </div>
                            ` : ''}
                            ${consecutive4Reward > 0 ? `
                            <div class="flex justify-between text-red-600">
                                <span>4ì£¼ì—°ì† (ì¡°ê±´ë¶€)</span>
                                <span class="font-bold">${consecutive4Reward}ë§Œì›</span>
                            </div>
                            ` : ''}
                            ${giftReward > 0 ? `
                            <div class="flex justify-between text-blue-600">
                                <span>ë¬¼í’ˆì‹œìƒ (ì¡°ê±´ë¶€)</span>
                                <span class="font-bold">${giftReward}ë§Œì›</span>
                            </div>
                            ` : ''}
                            <div class="flex justify-between pt-2 border-t-2 border-gray-200 font-bold">
                                <span>ì£¼ì°¨ í•©ê³„</span>
                                <span class="text-purple-600">${weekTotal}ë§Œì›</span>
                            </div>
                        </div>
                        ${consecutiveStatus || consecutive4Status || giftStatus ? `
                        <div class="mt-3 p-2 bg-yellow-50 rounded text-xs">
                            <div class="font-bold text-yellow-800 mb-1">ğŸ“Œ ì¡°ê±´ë¶€ ë‹¬ì„±</div>
                            ${consecutiveStatus ? `<div class="text-gray-700">${consecutiveStatus}</div>` : ''}
                            ${consecutive4Status ? `<div class="text-gray-700">${consecutive4Status}</div>` : ''}
                            ${giftStatus ? `<div class="text-gray-700">${giftStatus}</div>` : ''}
                            <div class="text-gray-600 mt-1">â€» ì°¨ì£¼ ì—°ì† ë‹¬ì„± ì‹œ í™•ì • ì§€ê¸‰</div>
                        </div>
                        ` : ''}
                    </div>
                `;
            }
            
            document.getElementById('weeklyData').innerHTML = weeklyHTML;
            
            // ì „ì²´ ì‹œë®¬ë ˆì´ì…˜ ê³„ì‚°
            let totalSimulationHTML = '';
            
            // ì „ì²´ tier ìˆ˜ì§‘
            const allWeekTiers = new Set();
            for (let w = 1; w <= 4; w++) {
                const wd = data.weekly[`week${w}`];
                Object.keys(wd.company).forEach(t => allWeekTiers.add(Number(t)));
                Object.keys(wd.self).forEach(t => allWeekTiers.add(Number(t)));
            }
            
            // í‰ê·  êµ¬ê°„ ê³„ì‚° (ë‹¤ìŒ ëª©í‘œ ì œì‹œ)
            const avgAmount = Math.floor(totalAmount / 4);
            const nextGoals = Array.from(allWeekTiers)
                .filter(t => t > avgAmount)
                .sort((a, b) => a - b)
                .slice(0, 2);
            
            if (nextGoals.length > 0) {
                totalSimulationHTML = '<div class="bg-white p-6 rounded-2xl border-2 border-purple-200 mb-4"><h3 class="text-lg font-bold mb-4 text-purple-800">ğŸ“Š ì£¼ì°¨ë³„ ì—…ì  ëª©í‘œ ì‹œë®¬ë ˆì´ì…˜</h3><div class="grid grid-cols-1 md:grid-cols-2 gap-4">';
                
                nextGoals.forEach((goal, idx) => {
                    const bgColor = idx === 0 ? 'bg-red-50' : 'bg-orange-50';
                    const textColor = idx === 0 ? 'text-red-700' : 'text-orange-700';
                    const borderColor = idx === 0 ? 'border-red-300' : 'border-orange-300';
                    const label = idx === 0 ? 'ğŸ¯ 1ì°¨ ëª©í‘œ' : 'ğŸ¯ 2ì°¨ ëª©í‘œ';
                    
                    totalSimulationHTML += `
                        <div class="p-4 ${bgColor} border-2 ${borderColor} rounded-xl">
                            <h4 class="font-bold ${textColor} mb-3">${label}: ì£¼ì°¨ë³„ ${goal}ë§Œì› ë‹¬ì„±</h4>
                            <div class="text-sm space-y-2">
                                <div class="flex justify-between">
                                    <span>í˜„ì¬ í‰ê· :</span>
                                    <span class="font-bold">${avgAmount}ë§Œì›</span>
                                </div>
                                <div class="flex justify-between ${textColor}">
                                    <span>ì£¼ì°¨ë³„ ë„ì „:</span>
                                    <span class="font-bold">+${goal - avgAmount}ë§Œì›</span>
                                </div>
                                <div class="p-2 bg-white rounded">
                                    <div class="text-xs text-gray-600">
                                        ğŸ’¡ ê° ì£¼ì°¨ë§ˆë‹¤ ${goal}ë§Œì›ì”© ë‹¬ì„±í•˜ë©´<br>
                                        ë” ë†’ì€ ì‹œìƒ êµ¬ê°„ì— ì§„ì…í•©ë‹ˆë‹¤!
                                    </div>
                                </div>
                            </div>
                        </div>
                    `;
                });
                
                totalSimulationHTML += '</div></div>';
            }
            
            document.getElementById('totalSimulation').innerHTML = totalSimulationHTML;
            
            // ë°±ë°±ì²œì²œ ì‹œìƒê¸ˆ ê³„ì‚° (í•œ ë‹¬ í•©ê³„ ê¸°ì¤€)
            let baekbaekReward = 0;
            if (data.baekbaek && totalAmount >= 50) {
                const baekbaekTiers = Object.keys(data.baekbaek).map(Number).sort((a, b) => b - a);
                for (let tier of baekbaekTiers) {
                    if (totalAmount >= tier) {
                        baekbaekReward = data.baekbaek[tier];
                        break;
                    }
                }
            }
            
            // ì´ ì‹œì±…ê¸ˆ ê²°ê³¼ í‘œì‹œ
            document.getElementById('resultCompanyName').textContent = data.name;
            document.getElementById('grandTotal').textContent = `${totalReward}ë§Œì›`;
            document.getElementById('totalAmount').textContent = `${totalAmount}ë§Œì›`;
            
            // ë°±ë°±ì²œì²œ í‘œì‹œ
            const baekbaekElement = document.getElementById('baekbaekReward');
            if (baekbaekReward > 0) {
                baekbaekElement.innerHTML = `
                    <div class="mt-4 p-4 bg-gradient-to-r from-yellow-50 to-orange-50 border-2 border-yellow-300 rounded-xl">
                        <div class="flex items-center justify-between">
                            <div>
                                <span class="text-sm font-bold text-yellow-800">ğŸ’° ë°±ë°±ì²œì²œ ì‹œìƒê¸ˆ</span>
                                <span class="text-xs text-gray-600 ml-2">(ìµì›” ì§€ê¸‰)</span>
                            </div>
                            <span class="text-2xl font-black text-yellow-700">+${baekbaekReward}ë§Œì›</span>
                        </div>
                        <div class="mt-2 text-xs text-gray-600">
                            ì›”ë‚©ë³´í—˜ë£Œ ${totalAmount}ë§Œì› ë‹¬ì„±
                        </div>
                    </div>
                `;
                baekbaekElement.style.display = 'block';
            } else {
                baekbaekElement.style.display = 'none';
            }
            
            document.getElementById('detailBreakdown').innerHTML = detailHTML;
            document.getElementById('resultSection').style.display = 'block';
        }

        // ì„ íƒ í•´ì œ
        function clearSelection() {
            selectedEmployee = null;
            document.getElementById('employeeInfo').style.display = 'none';
            document.getElementById('resultSection').style.display = 'none';
        }

        // ==================== ì¸ì‡„ ê¸°ëŠ¥ ====================

        // ê°œë³„ ì‚¬ì› ì¸ì‡„
        function printEmployee() {
            if (!selectedEmployee) {
                showToast('ì¸ì‡„í•  ì‚¬ì›ì„ ì„ íƒí•´ì£¼ì„¸ìš”!', 'error');
                return;
            }
            
            window.print();
        }

        // ì„ íƒëœ ì‚¬ì› ìˆ˜ ì—…ë°ì´íŠ¸
        function updateSelectedCount() {
            const checkboxes = document.querySelectorAll('.employee-checkbox:checked');
            document.getElementById('selectedCount').textContent = checkboxes.length;
        }

        // ì „ì²´ ì„ íƒ
        function selectAllEmployees() {
            const checkboxes = document.querySelectorAll('.employee-checkbox');
            checkboxes.forEach(cb => cb.checked = true);
            updateSelectedCount();
        }

        // ì „ì²´ í•´ì œ
        function deselectAllEmployees() {
            const checkboxes = document.querySelectorAll('.employee-checkbox');
            checkboxes.forEach(cb => cb.checked = false);
            updateSelectedCount();
        }

        // ì„ íƒëœ ì‚¬ì›ë“¤ ì¼ê´„ ì¸ì‡„
        function printSelectedEmployees() {
            const checkboxes = document.querySelectorAll('.employee-checkbox:checked');
            
            if (checkboxes.length === 0) {
                showToast('ì¸ì‡„í•  ì‚¬ì›ì„ ì„ íƒí•´ì£¼ì„¸ìš”!', 'error');
                return;
            }
            
            // ì„ íƒëœ ì‚¬ì› ë°ì´í„° ìˆ˜ì§‘
            const selectedEmployees = [];
            checkboxes.forEach(cb => {
                try {
                    const empData = JSON.parse(cb.getAttribute('data-employee'));
                    selectedEmployees.push(empData);
                } catch (e) {
                    console.error('ì‚¬ì› ë°ì´í„° íŒŒì‹± ì˜¤ë¥˜:', e);
                }
            });
            
            if (selectedEmployees.length === 0) {
                showToast('ì„ íƒëœ ì‚¬ì› ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤!', 'error');
                return;
            }
            
            // ì¸ì‡„ìš© HTML ìƒì„±
            const printHTML = generateBulkPrintHTML(selectedEmployees);
            
            // ìƒˆ ì°½ì—ì„œ ì¸ì‡„
            const printWindow = window.open('', '_blank');
            printWindow.document.write(printHTML);
            printWindow.document.close();
            
            // ë¡œë“œ í›„ ì¸ì‡„
            printWindow.onload = function() {
                printWindow.print();
                // ì¸ì‡„ ì™„ë£Œ í›„ ì°½ ë‹«ê¸°
                setTimeout(() => {
                    printWindow.close();
                }, 100);
            };
            
            showToast(`âœ… ${selectedEmployees.length}ëª…ì˜ ì¸ì‡„ í™”ë©´ì„ ì¤€ë¹„í–ˆìŠµë‹ˆë‹¤!`, 'success');
        }

        // ì¼ê´„ ì¸ì‡„ìš© HTML ìƒì„±
        function generateBulkPrintHTML(employees) {
            const data = insuranceData[currentCompany];
            let html = `
<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì‹œì±…ê¸ˆ ê³„ì‚° ê²°ê³¼ - ì¼ê´„ ì¸ì‡„</title>
    <script src="https://cdn.tailwindcss.com"><` + `/script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700;900&display=swap');
        
        * {
            font-family: 'Noto Sans KR', sans-serif;
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        @page {
            size: A4;
            margin: 8mm;
        }
        
        body {
            background: white;
            font-size: 7pt;
        }
        
        .print-page {
            page-break-after: always;
            padding: 5px;
        }
        
        .print-page:last-child {
            page-break-after: auto;
        }
        
        * {
            page-break-inside: avoid;
        }
        
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-print-color-adjust: exact;
            print-color-adjust: exact;
        }
        
        .bg-green-50 { background-color: #f0fdf4; -webkit-print-color-adjust: exact; print-color-adjust: exact; }
        .bg-purple-50 { background-color: #faf5ff; -webkit-print-color-adjust: exact; print-color-adjust: exact; }
        .bg-white { background-color: #ffffff; }
        
        h1 { font-size: 12pt; margin: 0 0 2px 0; font-weight: 900; }
        h3 { font-size: 8pt; margin: 0 0 2px 0; font-weight: 700; }
        h4 { font-size: 7pt; margin: 0; font-weight: 700; }
        p { font-size: 7pt; margin: 0; }
        
        .text-xs { font-size: 7pt !important; }
        .text-2xl { font-size: 18pt !important; }
        
        .mb-2 { margin-bottom: 2px; }
        .p-2 { padding: 2px; }
        .p-3 { padding: 3px; }
        
        .grid { display: grid; }
        .grid-cols-2 { grid-template-columns: repeat(2, 1fr); }
        .grid-cols-4 { grid-template-columns: repeat(4, 1fr); }
        .gap-2 { gap: 2px; }
        
        .rounded { border-radius: 4px; }
        .border { border: 1px solid #e5e7eb; }
        .border-b { border-bottom: 1px solid #e5e7eb; }
        
        .text-center { text-align: center; }
        .text-gray-600 { color: #4b5563; }
        .text-purple-600 { color: #9333ea; }
        .text-green-600 { color: #16a34a; }
        .text-blue-600 { color: #2563eb; }
        .text-orange-600 { color: #ea580c; }
        .text-red-600 { color: #dc2626; }
        
        .font-bold { font-weight: 700; }
        .font-black { font-weight: 900; }
        
        .flex { display: flex; }
        .justify-between { justify-content: space-between; }
        .border-t { border-top: 1px solid #e5e7eb; }
        .pt-1 { padding-top: 1px; }
    </style>
</head>
<body>
`;
            
            // ê° ì‚¬ì›ë³„ë¡œ í˜ì´ì§€ ìƒì„±
            employees.forEach((emp, index) => {
                html += generateEmployeePrintPage(emp, data);
            });
            
            html += `
</body>
</html>
`;
            
            return html;
        }

        // ê°œë³„ ì‚¬ì› ì¸ì‡„ í˜ì´ì§€ ìƒì„±
        function generateEmployeePrintPage(employee, data) {
            let totalReward = 0;
            let totalAmount = 0;
            let weeklyHTML = '';
            let detailHTML = '';
            
            // ì—°ì†ê°€ë™ ì¤‘ë³µ ë°©ì§€
            const consecutiveDescAchieved = new Set();
            const consecutive4DescAchieved = new Set();
            const giftDescAchieved = new Set();
            
            for (let week = 1; week <= 4; week++) {
                const amount = employee.weeks[`week${week}`] || 0;
                totalAmount += amount;
                
                if (amount === 0) {
                    weeklyHTML += `<div class="bg-gray-50 p-2 rounded text-center"><p class="text-xs text-gray-400">${week}ì£¼ì°¨<br>ë°ì´í„° ì—†ìŒ</p></div>`;
                    continue;
                }
                
                const weekData = data.weekly[`week${week}`];
                const basicReward = Math.round(amount * (data.monthlyRate / 100));
                
                // ë³´í—˜ì‚¬ ì‹œìƒ
                let companyReward = 0;
                const companyTiers = Object.keys(weekData.company).map(Number).sort((a, b) => b - a);
                for (let tier of companyTiers) {
                    if (amount >= tier) {
                        companyReward = weekData.company[tier];
                        break;
                    }
                }
                
                // ìì²´ ì‹œìƒ
                let selfReward = 0;
                const selfTiers = Object.keys(weekData.self).map(Number).sort((a, b) => b - a);
                for (let tier of selfTiers) {
                    if (amount >= tier) {
                        selfReward = weekData.self[tier];
                        break;
                    }
                }
                
                // ì—°ì†ê°€ë™
                let consecutiveReward = 0;
                if (weekData.consecutive && weekData.consecutive.tiers) {
                    const consDesc = weekData.consecutive.desc || '';
                    const consTiers = Object.keys(weekData.consecutive.tiers).map(Number).sort((a, b) => b - a);
                    for (let tier of consTiers) {
                        if (amount >= tier && !consecutiveDescAchieved.has(consDesc)) {
                            consecutiveReward = weekData.consecutive.tiers[tier];
                            consecutiveDescAchieved.add(consDesc);
                            break;
                        }
                    }
                }
                
                // 4ì£¼ ì—°ì†ì¶”ê°€
                let consecutive4Reward = 0;
                if (weekData.consecutive4week && weekData.consecutive4week.tiers) {
                    const cons4Desc = weekData.consecutive4week.desc || '';
                    const cons4Tiers = Object.keys(weekData.consecutive4week.tiers).map(Number).sort((a, b) => b - a);
                    for (let tier of cons4Tiers) {
                        if (amount >= tier && !consecutive4DescAchieved.has(cons4Desc)) {
                            consecutive4Reward = weekData.consecutive4week.tiers[tier];
                            consecutive4DescAchieved.add(cons4Desc);
                            break;
                        }
                    }
                }
                
                // ë¬¼í’ˆì‹œìƒ
                let giftReward = 0;
                if (weekData.gift && weekData.gift.tiers) {
                    const giftDesc = weekData.gift.desc || '';
                    const giftTiers = Object.keys(weekData.gift.tiers).map(Number).sort((a, b) => b - a);
                    for (let tier of giftTiers) {
                        if (amount >= tier && !giftDescAchieved.has(giftDesc)) {
                            giftReward = weekData.gift.tiers[tier];
                            giftDescAchieved.add(giftDesc);
                            break;
                        }
                    }
                }
                
                const weekTotal = basicReward + companyReward + selfReward + consecutiveReward + consecutive4Reward + giftReward;
                totalReward += weekTotal;
                
                // ì£¼ì°¨ë³„ ê°„ë‹¨ í‘œì‹œ
                weeklyHTML += `
                    <div class="bg-green-50 p-2 rounded border border-green-200">
                        <p class="font-bold text-xs mb-1">${week}ì£¼ì°¨</p>
                        <p class="text-xs">ì›”ë‚©: <span class="font-bold text-purple-600">${amount}ë§Œ</span></p>
                        <p class="text-xs">ì‹œì±…: <span class="font-bold text-green-600">${weekTotal}ë§Œ</span></p>
                    </div>
                `;
                
                // ìƒì„¸ ë‚´ì—­
                detailHTML += `
                    <div class="bg-white p-2 rounded border border-gray-200">
                        <h4 class="font-bold text-xs text-purple-600 mb-1">${week}ì£¼ì°¨</h4>
                        <div class="space-y-0.5 text-xs">
                            <div class="flex justify-between"><span>ì›”ë‚©ë³´í—˜ë£Œ</span><span class="font-bold">${amount}ë§Œì›</span></div>
                            <div class="flex justify-between text-blue-600"><span>ì›”ì‹œì±…(ìµì›”) (${data.monthlyRate}%)</span><span class="font-bold">${basicReward}ë§Œì›</span></div>
                            <div class="flex justify-between text-green-600"><span>ì£¼ê°„ì‹œìƒ</span><span class="font-bold">${companyReward}ë§Œì›</span></div>
                            <div class="flex justify-between text-purple-600"><span>êµ¿ë¦¬ì¹˜ì£¼ê°„(ìµì›”)</span><span class="font-bold">${selfReward}ë§Œì›</span></div>
                            ${consecutiveReward > 0 ? `<div class="flex justify-between text-orange-600"><span>ì—°ì†ê°€ë™</span><span class="font-bold">${consecutiveReward}ë§Œì›</span></div>` : ''}
                            ${consecutive4Reward > 0 ? `<div class="flex justify-between text-red-600"><span>4ì£¼ì—°ì†</span><span class="font-bold">${consecutive4Reward}ë§Œì›</span></div>` : ''}
                            ${giftReward > 0 ? `<div class="flex justify-between text-blue-600"><span>ë¬¼í’ˆì‹œìƒ</span><span class="font-bold">${giftReward}ë§Œì›</span></div>` : ''}
                            <div class="flex justify-between pt-1 border-t font-bold text-purple-600"><span>í•©ê³„</span><span>${weekTotal}ë§Œì›</span></div>
                        </div>
                    </div>
                `;
            }
            
            return `
<div class="print-page">
    <div class="mb-2 pb-2 border-b border-gray-300">
        <h1 class="text-xl font-black text-purple-600" style="font-size: 18pt;">${data.name}</h1>
        <p class="text-xs text-gray-600">ì¶œë ¥ì¼: ${new Date().toLocaleDateString('ko-KR')}</p>
    </div>
    
    <div class="bg-purple-50 p-2 rounded mb-2 border border-purple-200">
        <div class="grid grid-cols-4 gap-2 text-xs">
            <div><p class="text-gray-600">ì´ë¦„</p><p class="font-bold">${employee.name}</p></div>
            <div><p class="text-gray-600">ì‚¬ì—…ë¶€</p><p class="font-bold">${employee.dept || '-'}</p></div>
            <div><p class="text-gray-600">ë³¸ë¶€</p><p class="font-bold">${employee.branch}</p></div>
            <div><p class="text-gray-600">ì§€ì </p><p class="font-bold">${employee.office}</p></div>
        </div>
    </div>
    
    <h3 class="font-bold text-xs mb-2">ğŸ“Š ${data.name} ì£¼ì°¨ë³„ ì›”ë‚©ë³´í—˜ë£Œ ë° ì‹œì±…ê¸ˆ</h3>
    <div class="grid grid-cols-4 gap-2 mb-2">
        ${weeklyHTML}
    </div>
    
    <div class="bg-gradient-to-r from-purple-50 to-pink-50 p-3 rounded text-center mb-2 border border-purple-200">
        <p class="text-gray-700 text-xs">ğŸ’ <span class="font-black" style="font-size: 14pt;">${data.name}</span> ì´ ì‹œì±…ê¸ˆ</p>
        <p class="text-2xl font-black text-purple-600">${totalReward}ë§Œì›</p>
        <p class="text-xs text-gray-600">ì´ ì›”ë‚©ë³´í—˜ë£Œ: <span class="font-bold">${totalAmount}ë§Œì›</span></p>
    </div>
    
    <h3 class="font-bold text-xs mb-2">ğŸ“‹ ì£¼ì°¨ë³„ ìƒì„¸ ë‚´ì—­</h3>
    <div class="grid grid-cols-2 gap-2">
        ${detailHTML}
    </div>
</div>
`;
        }

        // ==================== ì‹œì±… ì„¤ì • íƒ­ ====================

        // ë³´í—˜ì‚¬ íƒ­ ì „í™˜
        function showPolicyCompany(company) {
            currentPolicyCompany = company;
            
            // íƒ­ ë²„íŠ¼ ìŠ¤íƒ€ì¼
            document.querySelectorAll('[id^="policy-tab-"]').forEach(btn => {
                btn.classList.remove('active');
                btn.classList.add('bg-gray-100');
            });
            document.getElementById(`policy-tab-${company}`).classList.add('active');
            document.getElementById(`policy-tab-${company}`).classList.remove('bg-gray-100');
            
            // ì„¤ì • í¼ ìƒì„±
            generatePolicySettingsForm(company);
        }

        // ì„¤ì • í¼ ìƒì„±
        function generatePolicySettingsForm(company) {
            const data = insuranceData[company];
            
            let html = `
                <div class="bg-white rounded-2xl p-6 card-shadow">
                    <h2 class="text-2xl font-bold mb-6 text-gray-800">${data.name} ì„¤ì •</h2>
                    
                    ${company === 'db' ? `
                    <!-- ë…„ì›” ì„¤ì • (DBì†ë³´ì—ì„œë§Œ í‘œì‹œ) -->
                    <div class="bg-yellow-50 p-4 rounded-lg mb-6">
                        <h3 class="text-lg font-bold text-yellow-800 mb-4">ğŸ“… ë…„ì›” ì„¤ì •</h3>
                        <div>
                            <label class="block text-sm font-bold text-gray-700 mb-2">í˜„ì¬ ì‹œì±… ë…„ì›”</label>
                            <input type="text" id="currentMonth" value="${insuranceData.currentMonth || '2026ë…„ 1ì›”'}" 
                                   class="w-full px-4 py-3 border-2 border-gray-300 rounded-xl"
                                   placeholder="ì˜ˆ: 2026ë…„ 2ì›”">
                            <p class="text-xs text-gray-600 mt-2">ğŸ’¡ ë©”ì¸ í—¤ë”ì™€ ëª¨ë“  ë³´í—˜ì‚¬ì— ê³µí†µ ì ìš©ë©ë‹ˆë‹¤</p>
                        </div>
                    </div>
                    
                    <!-- ì£¼ì°¨ë³„ ê¸°ê°„ ì„¤ì • (DBì†ë³´ì—ì„œë§Œ í‘œì‹œ) -->
                    <div class="bg-green-50 p-4 rounded-lg mb-6">
                        <h3 class="text-lg font-bold text-green-800 mb-4">ğŸ“† ì£¼ì°¨ë³„ ê¸°ê°„ ì„¤ì •</h3>
                        <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                            <div>
                                <label class="block text-sm font-bold text-gray-700 mb-2">1ì£¼ì°¨</label>
                                <input type="text" id="week1_dateRange" value="${data.weekly.week1.dateRange || ''}" 
                                       class="w-full px-4 py-3 border-2 border-gray-300 rounded-xl"
                                       placeholder="ì˜ˆ: 2/1~2/8">
                            </div>
                            <div>
                                <label class="block text-sm font-bold text-gray-700 mb-2">2ì£¼ì°¨</label>
                                <input type="text" id="week2_dateRange" value="${data.weekly.week2.dateRange || ''}" 
                                       class="w-full px-4 py-3 border-2 border-gray-300 rounded-xl"
                                       placeholder="ì˜ˆ: 2/9~2/15">
                            </div>
                            <div>
                                <label class="block text-sm font-bold text-gray-700 mb-2">3ì£¼ì°¨</label>
                                <input type="text" id="week3_dateRange" value="${data.weekly.week3.dateRange || ''}" 
                                       class="w-full px-4 py-3 border-2 border-gray-300 rounded-xl"
                                       placeholder="ì˜ˆ: 2/16~2/22">
                            </div>
                            <div>
                                <label class="block text-sm font-bold text-gray-700 mb-2">4ì£¼ì°¨</label>
                                <input type="text" id="week4_dateRange" value="${data.weekly.week4.dateRange || ''}" 
                                       class="w-full px-4 py-3 border-2 border-gray-300 rounded-xl"
                                       placeholder="ì˜ˆ: 2/23~2/29">
                            </div>
                        </div>
                        <p class="text-xs text-gray-600 mt-2">ğŸ’¡ ê³„ì‚°ê¸° í™”ë©´ì˜ ì£¼ì°¨ë³„ ë°•ìŠ¤ì— í‘œì‹œë©ë‹ˆë‹¤ (ëª¨ë“  ë³´í—˜ì‚¬ ê³µí†µ ì ìš©)</p>
                    </div>
                    ` : ''}
                    
                    ${company === 'monthly' ? `
                    <!-- ì´ë‹¬ì£¼ë ¥ì‚¬ íšŒì‚¬ëª… ì„¤ì • -->
                    <div class="bg-purple-50 p-4 rounded-lg mb-6">
                        <h3 class="text-lg font-bold text-purple-800 mb-4">ğŸ¢ ì´ë‹¬ì£¼ë ¥ì‚¬ íšŒì‚¬ëª…</h3>
                        <div>
                            <label class="block text-sm font-bold text-gray-700 mb-2">í‘œì‹œí•  íšŒì‚¬ëª…</label>
                            <input type="text" id="${company}_displayName" value="${data.displayName || 'ì´ë‹¬ì£¼ë ¥ì‚¬'}" 
                                   class="w-full px-4 py-3 border-2 border-gray-300 rounded-xl"
                                   placeholder="ì˜ˆ: í˜„ëŒ€í•´ìƒ">
                            <p class="text-xs text-gray-600 mt-2">ğŸ’¡ ê³„ì‚°ê¸°ì—ì„œ ì´ ì´ë¦„ìœ¼ë¡œ í‘œì‹œë©ë‹ˆë‹¤</p>
                        </div>
                    </div>
                    ` : ''}
                    
                    <!-- ì›”ì‹œì±… ì„¤ì • -->
                    <div class="bg-blue-50 p-4 rounded-lg mb-6">
                        <h3 class="text-lg font-bold text-blue-800 mb-4">ğŸ“Œ ì›”ì‹œì±… (ìµì›” ì§€ê¸‰)</h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-bold text-gray-700 mb-2">ë³´ì¥ì„±(äºº) ì›”ë‚© ì§€ê¸‰ë¥  (%)</label>
                                <input type="number" id="${company}_monthlyRate" value="${data.monthlyRate}" 
                                       class="w-full px-4 py-3 border-2 border-gray-300 rounded-xl">
                            </div>
                            ${data.petRate !== undefined ? `
                            <div>
                                <label class="block text-sm font-bold text-gray-700 mb-2">í«ë³´í—˜ ì›”ë‚© ì§€ê¸‰ë¥  (%)</label>
                                <input type="number" id="${company}_petRate" value="${data.petRate}" 
                                       class="w-full px-4 py-3 border-2 border-gray-300 rounded-xl">
                            </div>
                            ` : ''}
                            ${data.selfMonthlyRate !== undefined ? `
                            <div>
                                <label class="block text-sm font-bold text-gray-700 mb-2">ìì²´ ì›”ì‹œì±… ì§€ê¸‰ë¥  (%)</label>
                                <input type="number" id="${company}_selfMonthlyRate" value="${data.selfMonthlyRate}" 
                                       class="w-full px-4 py-3 border-2 border-gray-300 rounded-xl">
                            </div>
                            ` : ''}
                        </div>
                    </div>

                    <!-- ì£¼ê°„ ì‹œì±… ì„¤ì • -->
                    <div class="space-y-6">
            `;

            // ê° ì£¼ì°¨ë³„ ì„¤ì •
            for (let week = 1; week <= 4; week++) {
                const weekData = data.weekly[`week${week}`];
                
                html += `
                    <div class="bg-green-50 p-4 rounded-lg">
                        <h3 class="text-lg font-bold text-green-800 mb-4">${week}ì£¼ì°¨ ì‹œì±…</h3>
                        
                        <!-- ì£¼ê°„ì‹œìƒ -->
                        <div class="mb-4">
                            <h4 class="font-bold text-gray-700 mb-2">ğŸ¢ ì£¼ê°„ì‹œìƒ (2ì°¨ë…„ ì§€ê¸‰)</h4>
                            <div class="grid grid-cols-3 md:grid-cols-6 gap-2">
                `;
                
                const companyTiers = [10, 20, 30, 50, 70, 100, 150, 200];
                companyTiers.forEach(tier => {
                    const value = weekData.company[tier] || 0;
                    html += `
                        <div>
                            <label class="block text-xs text-gray-600 mb-1">${tier}ë§Œì›</label>
                            <input type="number" id="${company}_week${week}_company_${tier}" value="${value}" 
                                   class="w-full px-2 py-2 border-2 border-gray-300 rounded-lg text-sm"
                                   placeholder="0">
                        </div>
                    `;
                });
                
                html += `
                            </div>
                        </div>

                        <!-- êµ¿ë¦¬ì¹˜ì£¼ê°„ (ìµì›”) -->
                        <div>
                            <h4 class="font-bold text-gray-700 mb-2">ğŸ’° êµ¿ë¦¬ì¹˜ì£¼ê°„ (ìµì›” ì§€ê¸‰)</h4>
                            <div class="grid grid-cols-3 md:grid-cols-6 gap-2">
                `;
                
                const selfTiers = [10, 20, 30, 50, 70, 100, 150, 200, 300, 500, 1000];
                selfTiers.forEach(tier => {
                    const value = weekData.self[tier] || 0;
                    html += `
                        <div>
                            <label class="block text-xs text-gray-600 mb-1">${tier}ë§Œì›</label>
                            <input type="number" id="${company}_week${week}_self_${tier}" value="${value}" 
                                   class="w-full px-2 py-2 border-2 border-gray-300 rounded-lg text-sm"
                                   placeholder="0">
                        </div>
                    `;
                });
                
                html += `
                            </div>
                        </div>

                        <!-- ì—°ì†ê°€ë™ ì‹œìƒ -->
                        <div class="mt-4">
                            <h4 class="font-bold text-gray-700 mb-2">ğŸ”¥ ì—°ì†ê°€ë™ ì‹œìƒ (ì¡°ê±´ë¶€)</h4>
                            <div class="mb-2">
                                <label class="block text-xs text-gray-600 mb-1">ì¡°ê±´ ì„¤ëª…</label>
                                <input type="text" id="${company}_week${week}_cons_desc" 
                                       value="${weekData.consecutive?.desc || ''}"
                                       class="w-full px-3 py-2 border-2 border-gray-300 rounded-lg text-sm"
                                       placeholder="ì˜ˆ: 12.15~12.31 + 1.1~1.18">
                            </div>
                            <div class="grid grid-cols-3 md:grid-cols-6 gap-2">
                `;
                
                const consTiers = [10, 20, 30, 50, 70, 100];
                consTiers.forEach(tier => {
                    const value = weekData.consecutive?.tiers?.[tier] || 0;
                    html += `
                        <div>
                            <label class="block text-xs text-gray-600 mb-1">${tier}ë§Œì›</label>
                            <input type="number" id="${company}_week${week}_cons_${tier}" value="${value}" 
                                   class="w-full px-2 py-2 border-2 border-orange-200 rounded-lg text-sm"
                                   placeholder="0">
                        </div>
                    `;
                });
                
                html += `
                            </div>
                        </div>
                `;
                
                // 4ì£¼ì°¨ë§Œ ì¶”ê°€ í•­ëª© (ifë¬¸ìœ¼ë¡œ ë¶„ë¦¬)
                if (week === 4) {
                    html += `
                        <!-- 4ì£¼ ì—°ì†ì¶”ê°€ (4ì£¼ì°¨ë§Œ) -->
                        <div class="mt-4">
                            <h4 class="font-bold text-gray-700 mb-2">ğŸ¯ 4ì£¼ ì—°ì†ì¶”ê°€ ì‹œìƒ (ì¡°ê±´ë¶€)</h4>
                            <div class="mb-2">
                                <label class="block text-xs text-gray-600 mb-1">ì¡°ê±´ ì„¤ëª…</label>
                                <input type="text" id="${company}_week${week}_cons4_desc" 
                                       value="${weekData.consecutive4week?.desc || ''}"
                                       class="w-full px-3 py-2 border-2 border-gray-300 rounded-lg text-sm"
                                       placeholder="ì˜ˆ: 1.26~1.31 + 2.1~2.8">
                            </div>
                            <div class="grid grid-cols-3 md:grid-cols-6 gap-2">
                    `;
                    
                    consTiers.forEach(tier => {
                        const value = weekData.consecutive4week?.tiers?.[tier] || 0;
                        html += `
                            <div>
                                <label class="block text-xs text-gray-600 mb-1">${tier}ë§Œì›</label>
                                <input type="number" id="${company}_week${week}_cons4_${tier}" value="${value}" 
                                       class="w-full px-2 py-2 border-2 border-red-200 rounded-lg text-sm"
                                       placeholder="0">
                            </div>
                        `;
                    });
                    
                    html += `
                            </div>
                        </div>

                        <!-- ë¬¼í’ˆì‹œìƒ (4ì£¼ì°¨ë§Œ) -->
                        <div class="mt-4">
                            <h4 class="font-bold text-gray-700 mb-2">ğŸ ë¬¼í’ˆì‹œìƒ (ì¡°ê±´ë¶€)</h4>
                            <div class="mb-2">
                                <label class="block text-xs text-gray-600 mb-1">ì¡°ê±´ ì„¤ëª…</label>
                                <input type="text" id="${company}_week${week}_gift_desc" 
                                       value="${weekData.gift?.desc || ''}"
                                       class="w-full px-3 py-2 border-2 border-gray-300 rounded-lg text-sm"
                                       placeholder="ì˜ˆ: 1.26~1.31 + 2.1~2.8">
                            </div>
                            <div class="grid grid-cols-3 md:grid-cols-6 gap-2">
                    `;
                    
                    consTiers.forEach(tier => {
                        const value = weekData.gift?.tiers?.[tier] || 0;
                        html += `
                            <div>
                                <label class="block text-xs text-gray-600 mb-1">${tier}ë§Œì›</label>
                                <input type="number" id="${company}_week${week}_gift_${tier}" value="${value}" 
                                       class="w-full px-2 py-2 border-2 border-blue-200 rounded-lg text-sm"
                                       placeholder="0">
                            </div>
                        `;
                    });
                    
                    html += `
                            </div>
                        </div>
                    `;
                }
                
                html += `
                    </div>
                `;
            }

            html += `
                    </div>

                    <!-- ì €ì¥ ë²„íŠ¼ -->
                    <div class="flex justify-end mt-6">
                        <button onclick="savePolicyCompanyData('${company}')" 
                                class="px-8 py-3 bg-gradient-to-r from-purple-500 to-pink-500 text-white font-bold rounded-xl hover:shadow-lg transition-all">
                            ğŸ’¾ ${data.name} ì €ì¥
                        </button>
                    </div>
                </div>
            `;

            document.getElementById('policySettings').innerHTML = html;
        }

        // ë³´í—˜ì‚¬ ì‹œì±… ë°ì´í„° ì €ì¥
        function savePolicyCompanyData(company) {
            const data = insuranceData[company];

            // DBì†ë³´ì—ì„œ ë…„ì›” ì„¤ì • ì €ì¥ (ì „ì²´ ê³µí†µ)
            if (company === 'db') {
                const newMonth = document.getElementById('currentMonth').value;
                insuranceData.currentMonth = newMonth;
                updateHeaderMonth();
                
                // ì£¼ì°¨ë³„ ê¸°ê°„ ì €ì¥ (ì „ì²´ ë³´í—˜ì‚¬ ê³µí†µ ì ìš©)
                for (let week = 1; week <= 4; week++) {
                    const newDateRange = document.getElementById(`week${week}_dateRange`).value;
                    ['db', 'heungkuk', 'meritz', 'kb', 'monthly'].forEach(comp => {
                        if (insuranceData[comp] && insuranceData[comp].weekly && insuranceData[comp].weekly[`week${week}`]) {
                            insuranceData[comp].weekly[`week${week}`].dateRange = newDateRange;
                        }
                    });
                }
            }

            // ì´ë‹¬ì£¼ë ¥ì‚¬ì˜ ê²½ìš° displayName ì €ì¥
            if (company === 'monthly') {
                const newDisplayName = document.getElementById(`${company}_displayName`).value;
                data.displayName = newDisplayName;
                updateMonthlyCompanyName(newDisplayName);
            }

            // ì›”ì‹œì±…
            data.monthlyRate = parseInt(document.getElementById(`${company}_monthlyRate`).value);
            if (data.petRate !== undefined) {
                data.petRate = parseInt(document.getElementById(`${company}_petRate`).value);
            }
            if (data.selfMonthlyRate !== undefined) {
                data.selfMonthlyRate = parseInt(document.getElementById(`${company}_selfMonthlyRate`).value);
            }

            // ì£¼ê°„ ì‹œì±…
            for (let week = 1; week <= 4; week++) {
                const companyTiers = {};
                const selfTiers = {};
                
                // ë³´í—˜ì‚¬ ì‹œìƒ
                [10, 20, 30, 50, 70, 100, 150, 200].forEach(tier => {
                    const input = document.getElementById(`${company}_week${week}_company_${tier}`);
                    if (input && input.value) {
                        const value = parseInt(input.value);
                        if (value > 0) {
                            companyTiers[tier] = value;
                        }
                    }
                });
                
                // ìì²´ ì‹œìƒ
                [10, 20, 30, 50, 70, 100, 150, 200, 300, 500, 1000].forEach(tier => {
                    const input = document.getElementById(`${company}_week${week}_self_${tier}`);
                    if (input && input.value) {
                        const value = parseInt(input.value);
                        if (value > 0) {
                            selfTiers[tier] = value;
                        }
                    }
                });
                
                // ì—°ì†ê°€ë™ ì‹œìƒ
                const consecutiveTiers = {};
                const consDesc = document.getElementById(`${company}_week${week}_cons_desc`)?.value || '';
                [10, 20, 30, 50, 70, 100].forEach(tier => {
                    const input = document.getElementById(`${company}_week${week}_cons_${tier}`);
                    if (input && input.value) {
                        const value = parseInt(input.value);
                        if (value > 0) {
                            consecutiveTiers[tier] = value;
                        }
                    }
                });
                
                // 4ì£¼ ì—°ì†ì¶”ê°€ ì‹œìƒ (4ì£¼ì°¨ë§Œ)
                let consecutive4week = null;
                if (week === 4) {
                    const consecutive4Tiers = {};
                    const cons4Desc = document.getElementById(`${company}_week${week}_cons4_desc`)?.value || '';
                    [10, 20, 30, 50, 70, 100].forEach(tier => {
                        const input = document.getElementById(`${company}_week${week}_cons4_${tier}`);
                        if (input && input.value) {
                            const value = parseInt(input.value);
                            if (value > 0) {
                                consecutive4Tiers[tier] = value;
                            }
                        }
                    });
                    
                    if (Object.keys(consecutive4Tiers).length > 0) {
                        consecutive4week = {
                            desc: cons4Desc,
                            tiers: consecutive4Tiers
                        };
                    }
                }
                
                // ë¬¼í’ˆì‹œìƒ (4ì£¼ì°¨ë§Œ)
                let gift = null;
                if (week === 4) {
                    const giftTiers = {};
                    const giftDesc = document.getElementById(`${company}_week${week}_gift_desc`)?.value || '';
                    [10, 20, 30, 50, 70, 100].forEach(tier => {
                        const input = document.getElementById(`${company}_week${week}_gift_${tier}`);
                        if (input && input.value) {
                            const value = parseInt(input.value);
                            if (value > 0) {
                                giftTiers[tier] = value;
                            }
                        }
                    });
                    
                    if (Object.keys(giftTiers).length > 0) {
                        gift = {
                            desc: giftDesc,
                            tiers: giftTiers
                        };
                    }
                }
                
                data.weekly[`week${week}`] = {
                    dateRange: data.weekly[`week${week}`].dateRange || '',
                    company: companyTiers,
                    self: selfTiers
                };
                
                if (Object.keys(consecutiveTiers).length > 0) {
                    data.weekly[`week${week}`].consecutive = {
                        desc: consDesc,
                        tiers: consecutiveTiers
                    };
                }
                
                if (consecutive4week) {
                    data.weekly[`week${week}`].consecutive4week = consecutive4week;
                }
                
                if (gift) {
                    data.weekly[`week${week}`].gift = gift;
                }
            }

            localStorage.setItem('insurance_policy_data', JSON.stringify(insuranceData));
            showToast(`âœ… ${data.name} ì‹œì±… ë°ì´í„°ê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!`, 'success');
        }

        // ì´ë‹¬ì£¼ë ¥ì‚¬ ì´ë¦„ ì—…ë°ì´íŠ¸
        function updateMonthlyCompanyName(name) {
            const displayName = name.split('\n');
            document.getElementById('monthly-company-name').innerHTML = displayName.join('<br>');
        }

        // ì „ì²´ ì‹œì±… ë°ì´í„° ì €ì¥
        function saveAllPolicyData() {
            localStorage.setItem('insurance_policy_data', JSON.stringify(insuranceData));
            showToast('âœ… ì „ì²´ ì‹œì±… ë°ì´í„°ê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!', 'success');
        }

        // ì‹œì±… ë°ì´í„° ë‚´ë³´ë‚´ê¸°
        function exportPolicyData() {
            const dataStr = JSON.stringify(insuranceData, null, 2);
            const blob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            
            const a = document.createElement('a');
            a.href = url;
            a.download = `ë³´í—˜ì‚¬ì‹œì±…ë°ì´í„°_${new Date().toISOString().split('T')[0]}.json`;
            a.click();
            
            URL.revokeObjectURL(url);
            showToast('âœ… ì‹œì±… ë°ì´í„° íŒŒì¼ì´ ë‹¤ìš´ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤!', 'success');
        }

        // ì‹œì±… ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
        function importPolicyData(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    insuranceData = JSON.parse(e.target.result);
                    localStorage.setItem('insurance_policy_data', JSON.stringify(insuranceData));
                    
                    // ì´ë‹¬ì£¼ë ¥ì‚¬ ì´ë¦„ ì—…ë°ì´íŠ¸
                    if (insuranceData.monthly && insuranceData.monthly.displayName) {
                        updateMonthlyCompanyName(insuranceData.monthly.displayName);
                    }
                    
                    showToast('âœ… ì‹œì±… ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì™”ìŠµë‹ˆë‹¤!', 'success');
                    showPolicyCompany(currentPolicyCompany);
                } catch (error) {
                    showToast('âŒ íŒŒì¼ì„ ì½ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message, 'error');
                }
            };
            reader.readAsText(file);
        }

        // ==================== ì¸ë³„ ë°ì´í„° ê´€ë¦¬ íƒ­ ====================

        // ë³´í—˜ì‚¬ ì„ íƒ (ì¸ë³„ ë°ì´í„°)
        function selectEmployeeCompany(company) {
            currentEmployeeCompany = company;
            
            document.querySelectorAll('[id^="emp-tab-"]').forEach(btn => {
                btn.classList.remove('active');
                btn.classList.add('bg-gray-100');
            });
            document.getElementById(`emp-tab-${company}`).classList.add('active');
            document.getElementById(`emp-tab-${company}`).classList.remove('bg-gray-100');
            
            updateCurrentSelection();
            updateDataStatus();
        }

        // ì£¼ì°¨ ì„ íƒ
        function selectWeek(week) {
            currentWeek = week;
            
            document.querySelectorAll('.tab-button[id^="week-"]').forEach(btn => {
                btn.classList.remove('active');
                btn.classList.add('bg-gray-100');
            });
            document.getElementById(`week-${week}`).classList.add('active');
            document.getElementById(`week-${week}`).classList.remove('bg-gray-100');
            
            updateCurrentSelection();
        }

        // í˜„ì¬ ì„ íƒ ì—…ë°ì´íŠ¸
        function updateCurrentSelection() {
            const weekLabel = currentWeek === 0 ? 'ì „ì£¼ì°¨(ì „ì›”)' : `${currentWeek}ì£¼ì°¨`;
            document.getElementById('currentSelection').textContent = 
                `${companyNames[currentEmployeeCompany]} ${weekLabel}`;
        }

        // ë¶™ì—¬ë„£ê¸° ì˜ì—­ ì´ˆê¸°í™”
        function clearPasteArea() {
            document.getElementById('pasteArea').value = '';
            document.getElementById('previewSection').style.display = 'none';
        }

        // ë°ì´í„° íŒŒì‹± ë° ì €ì¥
        function parseAndSaveData() {
            const pasteText = document.getElementById('pasteArea').value.trim();
            
            if (!pasteText) {
                showToast('ë°ì´í„°ë¥¼ ë¶™ì—¬ë„£ì–´ì£¼ì„¸ìš”!', 'error');
                return;
            }

            try {
                // íƒ­ìœ¼ë¡œ êµ¬ë¶„ëœ ë°ì´í„° íŒŒì‹±
                const rows = pasteText.split('\n').filter(row => row.trim());
                
                if (rows.length < 2) {
                    showToast('ìµœì†Œ 2ì¤„ ì´ìƒì˜ ë°ì´í„°ê°€ í•„ìš”í•©ë‹ˆë‹¤ (í—¤ë” + ë°ì´í„°)', 'error');
                    return;
                }

                // í—¤ë” í–‰ íŒŒì‹±
                const headers = rows[0].split('\t').map(h => h.trim());
                
                // í•„ìˆ˜ ì»¬ëŸ¼ í™•ì¸
                const nameIdx = headers.findIndex(h => h.includes('ì´ë¦„'));
                const deptIdx = headers.findIndex(h => h.includes('ì‚¬ì—…ë¶€'));
                const branchIdx = headers.findIndex(h => h.includes('ë³¸ë¶€'));
                const officeIdx = headers.findIndex(h => h.includes('ì§€ì '));
                const amountIdx = headers.findIndex(h => h.includes('ì›”ë‚©ë³´í—˜ë£Œ'));

                if (nameIdx === -1 || branchIdx === -1 || officeIdx === -1 || amountIdx === -1) {
                    showToast('í•„ìˆ˜ ì»¬ëŸ¼(ì´ë¦„, ë³¸ë¶€, ì§€ì , ì›”ë‚©ë³´í—˜ë£Œ)ì´ ì—†ìŠµë‹ˆë‹¤!', 'error');
                    return;
                }

                // ë°ì´í„° íŒŒì‹±
                const parsedData = [];
                
                for (let i = 1; i < rows.length; i++) {
                    const cols = rows[i].split('\t');
                    
                    if (cols.length < headers.length - 3) continue;
                    
                    const name = cols[nameIdx]?.trim();
                    const dept = deptIdx !== -1 ? cols[deptIdx]?.trim() : '';
                    const branch = cols[branchIdx]?.trim();
                    const office = cols[officeIdx]?.trim();
                    const amountStr = cols[amountIdx]?.trim().replace(/,/g, '');
                    const amount = Math.floor(parseInt(amountStr) / 10000);

                    if (name && branch && office && !isNaN(amount) && amount > 0) {
                        parsedData.push({
                            name: name,
                            dept: dept,
                            branch: branch,
                            office: office,
                            amount: amount
                        });
                    }
                }

                if (parsedData.length === 0) {
                    showToast('íŒŒì‹±ëœ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤. ë°ì´í„° í˜•ì‹ì„ í™•ì¸í•´ì£¼ì„¸ìš”.', 'error');
                    return;
                }

                // ë°ì´í„° ì €ì¥
                employeeData[currentEmployeeCompany][`week${currentWeek}`] = parsedData;

                // ë¯¸ë¦¬ë³´ê¸° í‘œì‹œ
                showPreview(parsedData);
                
                // ìƒíƒœ ì—…ë°ì´íŠ¸
                updateDataStatus();
                
                showToast(`âœ… ${parsedData.length}ëª…ì˜ ë°ì´í„°ê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!`, 'success');

            } catch (error) {
                console.error(error);
                showToast('ë°ì´í„° íŒŒì‹± ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message, 'error');
            }
        }

        // ë¯¸ë¦¬ë³´ê¸° í‘œì‹œ
        function showPreview(data) {
            document.getElementById('totalRows').textContent = data.length;
            
            let html = '<table class="w-full text-left"><thead><tr class="bg-gray-100">';
            html += '<th class="p-2">ì´ë¦„</th><th class="p-2">ì‚¬ì—…ë¶€</th><th class="p-2">ë³¸ë¶€</th><th class="p-2">ì§€ì </th><th class="p-2">ì›”ë‚©ë³´í—˜ë£Œ(ë§Œì›)</th></tr></thead><tbody>';
            
            data.slice(0, 10).forEach(row => {
                html += `<tr class="border-b">
                    <td class="p-2">${row.name}</td>
                    <td class="p-2">${row.dept}</td>
                    <td class="p-2">${row.branch}</td>
                    <td class="p-2">${row.office}</td>
                    <td class="p-2 font-bold text-purple-600">${row.amount}</td>
                </tr>`;
            });
            
            if (data.length > 10) {
                html += `<tr><td colspan="5" class="p-2 text-center text-gray-500">... ì™¸ ${data.length - 10}ëª…</td></tr>`;
            }
            
            html += '</tbody></table>';
            
            document.getElementById('previewData').innerHTML = html;
            document.getElementById('previewSection').style.display = 'block';
        }

        // ë°ì´í„° í˜„í™© ì—…ë°ì´íŠ¸
        function updateDataStatus() {
            let html = '';
            
            Object.keys(companyNames).forEach(company => {
                const weekCounts = [
                    (employeeData[company].week0 || []).length,
                    (employeeData[company].week1 || []).length,
                    (employeeData[company].week2 || []).length,
                    (employeeData[company].week3 || []).length,
                    (employeeData[company].week4 || []).length
                ];
                
                const totalCount = weekCounts.reduce((a, b) => a + b, 0);
                const bgColor = totalCount > 0 ? 'bg-green-50 border-green-200' : 'bg-gray-50 border-gray-200';
                
                html += `
                    <div class="p-4 border-2 ${bgColor} rounded-xl">
                        <h3 class="font-bold mb-2">${companyNames[company]}</h3>
                        <div class="text-sm space-y-1">
                            <div>ì „ì£¼ì°¨: <span class="font-bold ${weekCounts[0] > 0 ? 'text-blue-600' : 'text-gray-400'}">${weekCounts[0]}ëª…</span></div>
                            <div>1ì£¼ì°¨: <span class="font-bold ${weekCounts[1] > 0 ? 'text-green-600' : 'text-gray-400'}">${weekCounts[1]}ëª…</span></div>
                            <div>2ì£¼ì°¨: <span class="font-bold ${weekCounts[2] > 0 ? 'text-green-600' : 'text-gray-400'}">${weekCounts[2]}ëª…</span></div>
                            <div>3ì£¼ì°¨: <span class="font-bold ${weekCounts[3] > 0 ? 'text-green-600' : 'text-gray-400'}">${weekCounts[3]}ëª…</span></div>
                            <div>4ì£¼ì°¨: <span class="font-bold ${weekCounts[4] > 0 ? 'text-green-600' : 'text-gray-400'}">${weekCounts[4]}ëª…</span></div>
                        </div>
                    </div>
                `;
            });
            
            document.getElementById('dataStatus').innerHTML = html;
        }

        // ì „ì²´ ì¸ë³„ ë°ì´í„° ì €ì¥
        function saveAllEmployeeData() {
            localStorage.setItem('employee_data_v2', JSON.stringify(employeeData));
            showToast('âœ… ì „ì²´ ì¸ë³„ ë°ì´í„°ê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!', 'success');
        }

        // ì¸ë³„ ë°ì´í„° ë‚´ë³´ë‚´ê¸°
        function exportEmployeeData() {
            const dataStr = JSON.stringify(employeeData, null, 2);
            const blob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            
            const a = document.createElement('a');
            a.href = url;
            a.download = `ì¸ë³„ì—…ì ë°ì´í„°_${new Date().toISOString().split('T')[0]}.json`;
            a.click();
            
            URL.revokeObjectURL(url);
            showToast('âœ… ì¸ë³„ ë°ì´í„° íŒŒì¼ì´ ë‹¤ìš´ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤!', 'success');
        }

        // ì¸ë³„ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
        function importEmployeeData(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    employeeData = JSON.parse(e.target.result);
                    localStorage.setItem('employee_data_v2', JSON.stringify(employeeData));
                    showToast('âœ… ì¸ë³„ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì™”ìŠµë‹ˆë‹¤!', 'success');
                    updateDataStatus();
                } catch (error) {
                    showToast('âŒ íŒŒì¼ì„ ì½ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message, 'error');
                }
            };
            reader.readAsText(file);
        }

        // ì „ì²´ ì¸ë³„ ë°ì´í„° ì´ˆê¸°í™”
        function clearAllEmployeeData() {
            if (!confirm('âš ï¸ ì •ë§ë¡œ ëª¨ë“  ì¸ë³„ ë°ì´í„°ë¥¼ ì´ˆê¸°í™”í•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n\nì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤!\nì´ˆê¸°í™” í›„ ê´€ë¦¬ì í˜ì´ì§€ì—ì„œ ë°ì´í„°ë¥¼ ë‹¤ì‹œ ì…ë ¥í•´ì•¼ í•©ë‹ˆë‹¤.')) {
                return;
            }
            
            if (!confirm('âš ï¸ ë‹¤ì‹œ í•œ ë²ˆ í™•ì¸í•©ë‹ˆë‹¤.\nëª¨ë“  ë³´í—˜ì‚¬ì˜ ëª¨ë“  ì£¼ì°¨ ë°ì´í„°ê°€ ì‚­ì œë©ë‹ˆë‹¤.\nê³„ì†í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                return;
            }
            
            // employeeData ì´ˆê¸°í™”
            employeeData = {
                db: { week0: [], week1: [], week2: [], week3: [], week4: [] },
                heungkuk: { week0: [], week1: [], week2: [], week3: [], week4: [] },
                meritz: { week0: [], week1: [], week2: [], week3: [], week4: [] },
                kb: { week0: [], week1: [], week2: [], week3: [], week4: [] },
                monthly: { week0: [], week1: [], week2: [], week3: [], week4: [] }
            };
            
            // localStorageì— ì €ì¥
            localStorage.setItem('employee_data_v2', JSON.stringify(employeeData));
            
            // í™”ë©´ ì—…ë°ì´íŠ¸
            updateDataStatus();
            document.getElementById('searchResults').innerHTML = '<p class="text-gray-500 text-center py-8">ë°ì´í„°ê°€ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤. ê´€ë¦¬ì í˜ì´ì§€ì—ì„œ ë°ì´í„°ë¥¼ ë‹¤ì‹œ ì…ë ¥í•´ì£¼ì„¸ìš”.</p>';
            
            showToast('âœ… ëª¨ë“  ì¸ë³„ ë°ì´í„°ê°€ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤. ë°ì´í„°ë¥¼ ë‹¤ì‹œ ì…ë ¥í•´ì£¼ì„¸ìš”.', 'success');
        }

        // Toast ì•Œë¦¼
        function showToast(message, type = 'success') {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.style.background = type === 'success' ? '#10b981' : '#ef4444';
            toast.style.display = 'block';
            
            setTimeout(() => {
                toast.style.display = 'none';
            }, 3000);
        }

        // í˜ì´ì§€ ë¡œë“œ
        window.addEventListener('load', function() {
            // localStorageì—ì„œ ë°ì´í„° ë¡œë“œ
            const savedEmployeeData = localStorage.getItem('employee_data_v2');
            if (savedEmployeeData) {
                try {
                    const loadedData = JSON.parse(savedEmployeeData);
                    // ë°ì´í„° ë§ˆì´ê·¸ë ˆì´ì…˜: week0ì´ ì—†ìœ¼ë©´ ì¶”ê°€
                    Object.keys(employeeData).forEach(company => {
                        if (loadedData[company]) {
                            if (!loadedData[company].week0) {
                                loadedData[company].week0 = [];
                            }
                            employeeData[company] = loadedData[company];
                        }
                    });
                } catch (error) {
                    console.error('ì‚¬ì› ë°ì´í„° ë¡œë“œ ì˜¤ë¥˜:', error);
                }
            }
            
            const savedPolicyData = localStorage.getItem('insurance_policy_data');
            if (savedPolicyData) {
                insuranceData = JSON.parse(savedPolicyData);
                
                // ë°±ë°±ì²œì²œ ë°ì´í„°ê°€ ì—†ìœ¼ë©´ ê¸°ë³¸ê°’ ì¶”ê°€
                if (!insuranceData.db.baekbaek) {
                    insuranceData.db.baekbaek = {
                        50: 20, 100: 100, 200: 200, 300: 300, 400: 400,
                        500: 500, 600: 600, 700: 700, 800: 800, 900: 900, 1000: 1000
                    };
                }
                if (!insuranceData.heungkuk.baekbaek) {
                    insuranceData.heungkuk.baekbaek = {
                        50: 30, 100: 100, 200: 200, 300: 300, 400: 400,
                        500: 500, 600: 600, 700: 700, 800: 800, 900: 900, 1000: 1000
                    };
                }
                if (!insuranceData.kb.baekbaek) {
                    insuranceData.kb.baekbaek = {
                        50: 25, 100: 100, 200: 200, 300: 300, 400: 400,
                        500: 500, 600: 600, 700: 700, 800: 800, 900: 900, 1000: 1000
                    };
                }
                
                // currentMonthê°€ ì—†ìœ¼ë©´ ê¸°ë³¸ê°’ ì¶”ê°€
                if (!insuranceData.currentMonth) {
                    insuranceData.currentMonth = '2026ë…„ 1ì›”';
                }
                
                // dateRangeê°€ ì—†ìœ¼ë©´ ê¸°ë³¸ê°’ ì¶”ê°€ (ëª¨ë“  ë³´í—˜ì‚¬)
                const defaultDateRanges = {
                    week1: '1/1~1/8',
                    week2: '1/9~1/15',
                    week3: '1/16~1/22',
                    week4: '1/23~1/31'
                };
                
                ['db', 'heungkuk', 'meritz', 'kb', 'monthly'].forEach(company => {
                    if (insuranceData[company] && insuranceData[company].weekly) {
                        for (let week of ['week1', 'week2', 'week3', 'week4']) {
                            if (insuranceData[company].weekly[week] && !insuranceData[company].weekly[week].dateRange) {
                                insuranceData[company].weekly[week].dateRange = defaultDateRanges[week];
                            }
                        }
                    }
                });
                
                // ì—…ë°ì´íŠ¸ëœ ë°ì´í„° ë‹¤ì‹œ ì €ì¥
                localStorage.setItem('insurance_policy_data', JSON.stringify(insuranceData));
                
                // ì´ë‹¬ì£¼ë ¥ì‚¬ ì´ë¦„ ì—…ë°ì´íŠ¸
                if (insuranceData.monthly && insuranceData.monthly.displayName) {
                    updateMonthlyCompanyName(insuranceData.monthly.displayName);
                }
            }
            
            updateHeaderMonth();
            updateCurrentSelection();
            updateDataStatus();
            
            console.log('âœ… ë³´í—˜ì‚¬ ì‹œì±… ê³„ì‚°ê¸° ì™„ì „ í†µí•© ë²„ì „ ë¡œë“œ ì™„ë£Œ');
        });
    </script>

</body>
</html>
